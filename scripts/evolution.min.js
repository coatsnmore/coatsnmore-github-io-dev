"use strict";var PixiGame=PixiGame||{},Utils=Utils||{};PixiGame.stage=null,PixiGame.renderer=null,PixiGame.gameLoopController=null,PixiGame.sceneController=null,PixiGame.world=null,PixiGame.controls=null,PixiGame.Notes=PixiGame.Notes||function(){var a={C0:16.35,"C#0/Db0":17.32,D0:18.35,"D#0/Eb0":19.45,E0:20.6,F0:21.83,"F#0/Gb0":23.12,G0:24.5,"G#0/Ab0":25.96,A0:27.5,"A#0/Bb0":29.14,B0:30.87,C1:32.7,"C#1/Db1":34.65,D1:36.71,"D#1/Eb1":38.89,E1:41.2,F1:43.65,"F#1/Gb1":46.25,G1:49,"G#1/Ab1":51.91,A1:55,"A#1/Bb1":58.27,B1:61.74,C2:65.41,"C#2/Db2":69.3,D2:73.42,"D#2/Eb2":77.78,E2:82.41,F2:87.31,"F#2/Gb2":92.5,G2:98,"G#2/Ab2":103.83,A2:110,"A#2/Bb2":116.54,B2:123.47,C3:130.81,"C#3/Db3":138.59,D3:146.83,"D#3/Eb3":155.56,E3:164.81,F3:174.61,"F#3/Gb3":185,G3:196,"G#3/Ab3":207.65,A3:220,"A#3/Bb3":233.08,B3:246.94,C4:261.63,"C#4/Db4":277.18,D4:293.66,"D#4/Eb4":311.13,E4:329.63,F4:349.23,"F#4/Gb4":369.99,G4:392,"G#4/Ab4":415.3,A4:440,"A#4/Bb4":466.16,B4:493.88,C5:523.25,"C#5/Db5":554.37,D5:587.33,"D#5/Eb5":622.25,E5:659.25,F5:698.46,"F#5/Gb5":739.99,G5:783.99,"G#5/Ab5":830.61,A5:880,"A#5/Bb5":932.33,B5:987.77,C6:1046.5,"C#6/Db6":1108.73,D6:1174.66,"D#6/Eb6":1244.51,E6:1318.51,F6:1396.91,"F#6/Gb6":1479.98,G6:1567.98,"G#6/Ab6":1661.22,A6:1760,"A#6/Bb6":1864.66,B6:1975.53,C7:2093,"C#7/Db7":2217.46,D7:2349.32,"D#7/Eb7":2489.02,E7:2637.02,F7:2793.83,"F#7/Gb7":2959.96,G7:3135.96,"G#7/Ab7":3322.44,A7:3520,"A#7/Bb7":3729.31,B7:3951.07,C8:4186.01,"C#8/Db8":4434.92,D8:4698.63,"D#8/Eb8":4978.03,E8:5274.04,F8:5587.65,"F#8/Gb8":5919.91,G8:6271.93,"G#8/Ab8":6644.88,A8:7040,"A#8/Bb8":7458.62,B8:7902.13};return{all:a}}(),PixiGame.Synth=PixiGame.Synth||function(){var a=PixiGame.Notes.all,b={},c=function(){f()},d=function(){for(var a=.5,c=b.currentTime,d=["G3","A#3/Bb3","D#4/Eb4","G3","A#3/Bb3","G#3/Ab3","G3"],e="sine",f=.1,h=0;h<d.length;h++)g(d[h],c+a*h,a,e,f)},e=function(){for(var a=.5,c=b.currentTime,d=["A2"],e="sawtooth",f=.1,h=0;h<d.length;h++)g(d[h],c+a*h,a,e,f)},f=function(){var a=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext;a?b=new a:console.error("Browser does not support AudioContext, uh oh!")},g=function(c,d,e,f,g){var h=b.createOscillator(),i=b.createOscillator(),j=b.createGain(),k=a[c];j.gain.value=g,h.type=f,i.type=f,h.frequency.value=k,i.frequency.value=k-3,h.connect(j),i.connect(j),j.connect(b.destination),j.gain.setValueAtTime(.1,d+e-.25),j.gain.linearRampToValueAtTime(0,d+e),h.start(d),i.start(d),h.stop(d+e),i.stop(d+e)};return{playSong:d,playLaser:e,init:c}}(),Utils.Colors=function(){var a=function(a){var b={};switch(b.background=13946044,a){case"attack":b.font=14893634,b.box=14893634;break;case"conversation":b.font=4351971,b.box=4351971;break;case"menu":b.font=0,b.box=0;break;case"trade":b.font=3964965,b.box=3964965;break;default:b.font=0,b.box=0}return b},b=function(a){var b={max:13930655,actual:12702864,font:0,border:0};return b},c=function(a){var b={background:13946044};return b},d=function(a){var b={background:13946044,font:0};return b},e=function(a){var b={background:13946044,font:0};return b};return{options:a,health:b,hud:c,log:d,turn:e}}(),Utils.OptionFactory=function(){var a=function(a,b,c,d,e){var f=5,g=new PIXI.Container,h=Utils.Colors.options,i=new PIXI.Graphics;i.beginFill(h(e).background),i.lineStyle(f,h(e).box),i.drawRect(0,0,d,c-f),i.endFill(),i.y=c*b,g.addChildAt(i,0);var j=new PIXI.Text(a.text,{font:"bold 20px Arial",fill:h(e).font,align:"center"});return j.x=d/2,j.y=c*b+f+c/3,j.anchor.x=.5,j.anchor.y=.5,j.wordWrap=!0,j.wordWrapWidth=d,g.addChildAt(j,1),g.interactive=!0,g.touchstart=g.mousedown=a.action,g.meta=a,g};return{createOption:a}}(),PixiGame.Controller=function(a){this._state={left:!1,right:!1,up:!1,fire:!1},this.setupPlayerControls()},PixiGame.Controller.constructor=PixiGame.Controller,PixiGame.Controller.prototype.setupPlayerControls=function(){window.addEventListener("keydown",function(a){this.changeControls(a.keyCode,!0)}.bind(this),!1),window.addEventListener("keyup",function(a){this.changeControls(a.keyCode,!1)}.bind(this),!1)},PixiGame.Controller.prototype.changeControls=function(a,b){switch(a){case 37:this._state.left=b;break;case 39:this._state.right=b;break;case 38:this._state.up=b;break;case 32:this._state.fire=b}},PixiGame.Controller.prototype.state=function(){return this._state},PixiGame.GameLoopController=function(){this._isGameActive=!1,this._fps=60,this._updateInterval=null},PixiGame.GameLoopController.constructor=PixiGame.GameLoopController,PixiGame.GameLoopController.prototype.tick=function(a){this._isGameActive&&(window.requestAnimationFrame(this.tick.bind(this)),PixiGame.sceneController.update(),PixiGame.world.step(1/this._fps),TWEEN.update(a),PixiGame.renderer.render(PixiGame.stage))},PixiGame.GameLoopController.prototype.start=function(){this._isGameActive||(this._isGameActive=!0,this.tick())},PixiGame.GameLoopController.prototype.pause=function(){this._isGameActive&&(clearInterval(this._updateInterval),this._isGameActive=!1)},Object.defineProperty(PixiGame.GameLoopController.prototype,"isPaused",{get:function(){return!this._isGameActive}}),PixiGame.SceneController=function(a){this._currentScene=new a,this._previousScene=null,PixiGame.stage.addChild(this._currentScene)},PixiGame.SceneController.constructor=PixiGame.SceneController,PixiGame.SceneController.prototype.update=function(){this._currentScene.update()},PixiGame.SceneController.prototype.requestSceneChange=function(a){null!==this._currentScene&&(this._previousScene=this._currentScene,this._previousScene.destroy(),PixiGame.stage.removeChild(this._previousScene)),this._currentScene=new a,PixiGame.stage.addChild(this._currentScene)},PixiGame.BaseScene=function(){var a=0,b=0,c=0,d=0,e=0,f=function(f){b=PixiGame.height*(2/3),this.margin=e=5,c=this.sizeX=PixiGame.width,d=this.sizeY=PixiGame.height/3;var g=new PIXI.Container,h=Utils.Colors.hud(),i=new PIXI.Graphics;return i.beginFill(h.background),i.lineStyle(1,h.background),i.drawRect(0,0,this.sizeX,this.sizeY),i.endFill(),g.addChildAt(i,0),g.x=a,g.y=b,g.alpha=.5,f.addChild(g),this},g=function(b){this.sizeX=100,this.sizeY=50;for(var c=[{text:"Menu",action:h}],d=(this.sizeX/c.length,new PIXI.Container),f=0;f<c.length;f++){var g=Utils.OptionFactory.createOption(c[f],f,this.sizeY,this.sizeX,"menu");d.addChild(g)}return d.x=a+e,d.y=PixiGame.height-this.sizeY-e,b.addChild(d),this},h=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.MainMenuScene)},i=function(c){var e,f,g=Utils.Colors.log(),h=new PIXI.Container,i=new PIXI.Graphics;return i.beginFill(g.background),i.lineStyle(1,g.background),i.drawRect(0,0,PixiGame.width/3,d/2),i.endFill(),i.y=0,h.addChildAt(i,0),this.drawDamage=function(){e=new PIXI.Text("",{font:"24px Arial",fill:g.font,align:"center"}),e.x=0,e.y=0,h.addChildAt(e,1)}.bind(c),this.drawDamage(),this.updateDamage=function(a){e.text=a}.bind(c),this.drawAction=function(){f=new PIXI.Text("",{font:"24px Arial",fill:g.font,align:"center"}),f.x=0,f.y=50,h.addChild(f)}.bind(c),this.drawAction(),this.updateAction=function(a){f.text=a}.bind(c),h.x=a+5,h.y=b+5,c.addChild(h),this},j=function(a){var b=Utils.Colors.turn();a._playerTurn=!0;var c,d="Turn: ";return this.draw=function(){c=new PIXI.Text(d+"Player",{font:"24px Arial",fill:b.font,align:"center"}),c.x=2*PixiGame.width/3,c.y=PixiGame.height-45,a.addChild(c)}.bind(a),this.draw(),this.update=function(b){b?(c.text=d+"Player",a._combatContainer.active(!0)):(c.text=d+"Enemy",a._combatContainer.active(!1))}.bind(a),this};return{menu:g,log:i,hud:f,turn:j}}(),PixiGame.HexScene=function(){PIXI.Graphics.call(this),this._menu=PixiGame.BaseScene.menu(this);var a=8,b=12;this._map={container:new PIXI.Container,tiles:{},tilesX:a,tilesY:b},this.setup()},PixiGame.HexScene.constructor=PixiGame.HexScene,PixiGame.HexScene.prototype=Object.create(PIXI.Graphics.prototype),PixiGame.HexScene.prototype.setup=function(){this.setupHexMap()},PixiGame.HexScene.prototype.setupHexMap=function(){var a=8,b=12,c=this._map,d=6,e=40,f=e,g=e;c.selectHex=function(d){console.log("coords:  "+d.coords),d.selected.alpha=.5;for(var e=1;a>=e;e++)for(var f=1;b>=f;f++){var g=c.tiles[""+e+f];g!==d&&(g.selected.alpha=0,g.option.alpha=0),Math.abs(e-d.coords[0])<=1&&Math.abs(f-d.coords[1])<=1&&(g.option.alpha=.25)}};for(var h=1;b>=h;h++)for(var i=1;a>=i;i++){var j=new PIXI.Container,k=new PIXI.Graphics,l=new PIXI.Graphics,m=new PIXI.Graphics;k.moveTo(f+e,g),k.lineStyle(2,3964965);for(var n=1;d>=n;n+=1)k.lineTo(f+e*Math.cos(2*n*Math.PI/d),g+e*Math.sin(2*n*Math.PI/d));j.addChild(k),l.moveTo(f+e,g),l.lineStyle(2,3964965),l.beginFill(3964965);for(var o=1;d>=o;o+=1)l.lineTo(f+e*Math.cos(2*o*Math.PI/d),g+e*Math.sin(2*o*Math.PI/d));l.alpha=0,j.selected=l,j.addChild(l),m.moveTo(f+e,g),m.lineStyle(2,4351971),m.beginFill(4351971);for(var p=1;d>=p;p+=1)m.lineTo(f+e*Math.cos(2*p*Math.PI/d),g+e*Math.sin(2*p*Math.PI/d));m.alpha=0,j.option=m,j.addChild(m);var q=new PIXI.Text(i+","+h,{font:"bold 20px Arial",fill:3964965,align:"center"});q.x=f,q.y=g,q.anchor.x=.5,q.anchor.y=.5,q.wordWrap=!0,q.wordWrapWidth=40,j.addChild(q),j.pivot.x=f,j.pivot.y=g,h%2===0?(j.x=i*e*3+1.5*e,j.y=h*e*Math.sqrt(3)/2):(j.x=i*e*3,j.y=h*e*Math.sqrt(3)/2),j.coords=[i,h],j.interactive=!0,j.shape=k,j.touchstart=j.mousedown=c.selectHex.bind(this,j),c.container.addChild(j),c.tiles[""+i+h]=j}c.y=100,this.addChild(c.container)},PixiGame.HexScene.prototype.update=function(){},PixiGame.HexScene.prototype.gameEnd=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.MainMenuScene)},PixiGame.HexScene.prototype.destroy=function(){this.removeChildren()},PixiGame.AnimationsScene=function(){PIXI.Graphics.call(this),this._menu=PixiGame.BaseScene.menu(this),this._box={},this._laser={},this._man={},this.setup()},PixiGame.AnimationsScene.constructor=PixiGame.AnimationsScene,PixiGame.AnimationsScene.prototype=Object.create(PIXI.Graphics.prototype),PixiGame.AnimationsScene.prototype.setup=function(){this._man=this.man(),this.controls()},PixiGame.AnimationsScene.prototype.controls=function(){for(var a=PixiGame.width/5,b=40,c=[{text:"Play Song",action:PixiGame.Synth.playSong},{text:"Man Dance",action:this._man.dance},{text:"Man Walk",action:this._man.walk},{text:"Man Laser Eyes",action:this._man.shootLaserEyes}],d=new PIXI.Container,e=0;e<c.length;e++){var f=Utils.OptionFactory.createOption(c[e],e,b,a,"menu");d.addChild(f)}d.x=0,d.y=0,this.addChild(d)},PixiGame.AnimationsScene.prototype.man=function(){var a=new PIXI.Container,b=new PIXI.Graphics;b.beginFill(3964965),b.drawRect(0,0,50,50),b.endFill(),b.x=0,b.y=0,a.addChild(b);var c=new PIXI.Graphics;c.beginFill(3964965),c.drawRect(-10,60,70,70),c.endFill(),a.addChild(c);var d=new PIXI.Graphics;d.beginFill(3964965),d.drawRect(-40,120,20,20),d.endFill(),a.addChild(d);var e=new PIXI.Graphics;e.beginFill(3964965),e.drawRect(70,120,20,20),e.endFill(),a.addChild(e);var f=new PIXI.Graphics;f.beginFill(3964965),f.drawRect(0,120,20,80),f.endFill(),a.addChild(f);var g=new PIXI.Graphics;g.beginFill(3964965),g.drawRect(30,120,20,80),g.endFill(),a.addChild(g);var h=new PIXI.Container,i=new PIXI.Graphics;i.beginFill(14893634),i.drawRect(25,20,50,2),i.endFill(),h.addChild(i);var j=new PIXI.Graphics;return j.beginFill(14893634),j.drawRect(40,10,50,2),j.endFill(),h.addChild(j),h.alpha=0,a.addChild(h),a.x=PixiGame.width/3,a.y=PixiGame.height/3,this.addChild(a),a.shootLaserEyes=function(){var a=800,b={x:h.x,y:h.y},c=[200,50],d=Math.atan(c[1]/c[0]);h.rotation=d;var e=new TWEEN.Tween(b).to({x:b.x+c[0],y:b.y+c[1]},a).onStart(function(){h.alpha=1,PixiGame.Synth.playLaser()}).onComplete(function(){h.alpha=0,h.x=0,h.y=0}).onUpdate(function(){h.x=this.x,h.y=this.y});e.start()},a.dance=function(){var f=400,g={x:a.x,y:a.y},h={x:b.x,y:b.y},i={x:c.x,y:c.y},j={x:d.x,y:d.y},k={x:e.x,y:e.y},l=new TWEEN.Tween(g).to({x:g.x+3,y:g.y+2},f).onUpdate(function(){a.x=this.x,a.y=this.y}),m=new TWEEN.Tween(g).to({x:g.x-3,y:g.y},f).onUpdate(function(){a.x=this.x,a.y=this.y}),n=new TWEEN.Tween(h).to({x:h.x,y:h.y+5},f).onUpdate(function(){b.x=this.x,b.y=this.y}),o=new TWEEN.Tween(h).to({x:h.x,y:h.y-5},f).onUpdate(function(){b.x=this.x,b.y=this.y}),p=new TWEEN.Tween(i).to({x:i.x,y:i.y+3},f).onUpdate(function(){c.x=this.x,c.y=this.y}),q=new TWEEN.Tween(i).to({x:i.x,y:i.y-3},f).onUpdate(function(){c.x=this.x,c.y=this.y}),r=new TWEEN.Tween(j).to({x:j.x-2,y:j.y+3},f).onUpdate(function(){d.x=this.x,d.y=this.y}),s=new TWEEN.Tween(j).to({x:j.x+2,y:j.y-3},f).onUpdate(function(){d.x=this.x,d.y=this.y}),t=new TWEEN.Tween(k).to({x:k.x+2,y:k.y+3},f).onUpdate(function(){e.x=this.x,e.y=this.y}),u=new TWEEN.Tween(k).to({x:k.x-2,y:k.y-3},f).onUpdate(function(){e.x=this.x,e.y=this.y});l.chain(m),m.chain(l),n.chain(o),o.chain(n),n.start(),p.chain(q),q.chain(p),p.start(),r.chain(s),s.chain(r),r.start(),t.chain(u),u.chain(t),t.start()},a.walk=function(){var a=800,b=10,c={x:f.x,y:f.y},d={x:g.x,y:g.y},e=new TWEEN.Tween(c).to({x:c.x+b,y:c.y},a).onUpdate(function(){f.x=this.x,f.y=this.y,f.rotation-=Math.atan(2/3)*(2/a)}),h=new TWEEN.Tween(c).to({x:c.x-b/2,y:c.y},a).onUpdate(function(){f.x=this.x,f.y=this.y,f.rotation+=Math.atan(2/3)*(2/a)}),i=new TWEEN.Tween(d).to({x:d.x-b,y:d.y},a).onUpdate(function(){g.x=this.x,g.y=this.y,g.rotation+=Math.atan(1.5)*(2/a)}),j=new TWEEN.Tween(d).to({x:d.x+b/2,y:d.y},a).onUpdate(function(){g.x=this.x,g.y=this.y,g.rotation-=Math.atan(1.5)*(2/a)});e.chain(h),h.chain(e),e.start(),i.chain(j),j.chain(i),i.start()},a},PixiGame.AnimationsScene.prototype.update=function(){},PixiGame.AnimationsScene.prototype.gameEnd=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.MainMenuScene)},PixiGame.AnimationsScene.prototype.destroy=function(){this.removeChildren()},PixiGame.MainMenuScene=function(){PIXI.Graphics.call(this),this._playButton=null,this.setup()},PixiGame.MainMenuScene.constructor=PixiGame.MainMenuScene,PixiGame.MainMenuScene.prototype=Object.create(PIXI.Graphics.prototype),PixiGame.MainMenuScene.prototype.setup=function(){var a=PixiGame.width/3,b=60,c=new PIXI.Text("Evolution Game Components",{font:"bold 48px Arial",fill:16777215,align:"center",wordWrap:!0,wordWrapWidth:a});c.x=a,c.y=10,this.addChild(c);for(var d=[{text:"Space",action:this.handleSpace.bind(this)},{text:"Conversation",action:this.handleConversation.bind(this)},{text:"Combat",action:this.handleCombat.bind(this)},{text:"Animations",action:this.handleAnimations.bind(this)},{text:"Hex",action:this.handleHex.bind(this)}],e=new PIXI.Container,f=0;f<d.length;f++){var g=Utils.OptionFactory.createOption(d[f],f,b,a,"menu");e.addChild(g)}e.x=PixiGame.width/3,e.y=PixiGame.height/3,this.addChild(e)},PixiGame.MainMenuScene.prototype.handleConversation=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.RPGScene)},PixiGame.MainMenuScene.prototype.handleSpace=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.GameScene)},PixiGame.MainMenuScene.prototype.handleCombat=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.CombatScene)},PixiGame.MainMenuScene.prototype.handleAnimations=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.AnimationsScene)},PixiGame.MainMenuScene.prototype.handleHex=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.HexScene)},PixiGame.MainMenuScene.prototype.update=function(){},PixiGame.MainMenuScene.prototype.destroy=function(){this.removeChildren(),this._playButton=null},PixiGame.GameScene=function(){PIXI.Graphics.call(this),this._menu=PixiGame.BaseScene.menu(this),this._player={score:0,health:100,body:null,shape:null,graphics:null,size:50,speed:100,turnSpeed:2,bullets:{collection:[],speed:50,max:1,size:5}},this._enemies={collection:[],speed:75,size:50,amount:0,max:10},this.setup()},PixiGame.GameScene.constructor=PixiGame.GameScene,PixiGame.GameScene.prototype=Object.create(PIXI.Graphics.prototype),PixiGame.GameScene.prototype.setup=function(){this.hud().setup(),this.setupPlayer(),this.setupEnemies()},PixiGame.GameScene.prototype.hud=function(){var a=this,b={position:[20,20],setup:function(){var b=new PIXI.Container;b.x=this.position[0],b.y=this.position[1],this.score.redraw(b),this.health.redraw(b),a.addChildAt(b,0)},score:{text:"Score: ",update:function(b){a._player.score+=b,a.getChildAt(0).getChildAt(0).text=this.text+a._player.score},redraw:function(b){var c=new PIXI.Text(this.text+a._player.score,{font:"24px Arial",fill:16715792,align:"center"});b.addChildAt(c,0)}},health:{text:"Health: ",update:function(b){a._player.health+=b,a.getChildAt(0).getChildAt(1).text=this.text+Math.round(a._player.health)},redraw:function(b){var c=new PIXI.Text(this.text+a._player.health,{font:"24px Arial",fill:16715792,align:"center"});c.y=25,b.addChildAt(c,1)}}};return b},PixiGame.GameScene.prototype.playerFire=function(){var a=1.5*this._player.speed,b=this._player.body.angle-Math.PI/2,c={graphics:new PIXI.Graphics,body:new p2.Body({mass:0,damping:0,angularDamping:0}),active:!1};c.body.velocity[0]+=a*Math.cos(b)+this._player.body.velocity[0],c.body.velocity[1]+=a*Math.sin(b)+this._player.body.velocity[1],c.body.position[0]=this._player.size/2*Math.cos(b)+this._player.body.position[0],c.body.position[1]=this._player.size/2*Math.sin(b)+this._player.body.position[1];var d=new p2.Circle({radius:this._player.bullets.size});c.body.addShape(d),PixiGame.world.addBody(c.body),c.graphics.beginFill(16777215),c.graphics.lineStyle(1,16711680),c.graphics.drawRect(0,0,this._player.bullets.size,this._player.bullets.size),c.graphics.drawCircle(0,0,this._player.bullets.size),c.graphics.endFill(),this.addChild(c.graphics),this._player.bullets.collection.push(c)},PixiGame.GameScene.prototype.setupEnemies=function(){var a=this._enemies;setInterval(function(){if(!(a.amount>=a.max)){var b=Math.round(Math.random()*PixiGame.width),c=Math.round(Math.random()*PixiGame.height),d=(Math.random()-.5)*a.speed,e=(Math.random()-.5)*a.speed,f=(Math.random()-.5)*a.speed,g={body:new p2.Body({position:[b,c],mass:.1,damping:0,angularDamping:0,velocity:[d,e],angularVelocity:f}),graphics:new PIXI.Container},h=new p2.Circle({radius:a.size});g.body.addShape(h),PixiGame.world.addBody(g.body);var i=new PIXI.Graphics;i.beginFill(8054410),i.drawCircle(0,0,a.size),i.endFill(),g.graphics.addChild(i),this.addChild(g.graphics),a.collection.push(g),a.amount++}}.bind(this),1e3)},PixiGame.GameScene.prototype.setupPlayerBullets=function(){for(var a=(this._player,this._player.bullets),b=300,c=300,d=0;d<a.max;d++)a.bodies[d]=new p2.Body({mass:1,angularVelocity:0,damping:0,angularDamping:0,position:[b,c]}),a.shapes[d]=new p2.Box({width:a.size,height:a.size}),a.bodies[d].addShape(a.shapes[d]),PixiGame.world.addBody(a.bodies[d]),a.graphics[d]=new PIXI.Graphics,a.graphics[d].beginFill(16777215),a.graphics[d].lineStyle(5,16711680),a.graphics[d].drawRect(b,c,a.size,a.size),a.graphics[d].endFill(),this.addChild(a.graphics[d])},PixiGame.GameScene.prototype.setupPlayer=function(){var a=this._player;a.body=new p2.Body({mass:1,angularVelocity:0,damping:0,angularDamping:0,position:[PixiGame.width/2,PixiGame.height/2]}),a.shape=new p2.Box({width:a.size,height:a.size}),a.body.addShape(a.shape),PixiGame.world.addBody(a.body),a.graphics=new PIXI.Container;var b=new PIXI.Graphics;b.beginFill(12240598),b.moveTo(0,a.size),b.lineTo(0,a.size*(2/3)),b.lineTo(a.size/2,0),b.lineTo(a.size,a.size*(2/3)),b.lineTo(a.size,a.size),b.lineTo(a.size*(2/3),a.size*(2/3)),b.lineTo(a.size*(1/3),a.size*(2/3)),b.endFill(),a.graphics.addChildAt(b,0);var c=new PIXI.Graphics;c.beginFill(16248160),c.moveTo(a.size*(1/3),a.size*(2/3)),c.lineTo(a.size*(2/3),a.size*(2/3)),c.lineTo(.5*a.size,a.size),c.endFill(),c.alpha=0,a.graphics.addChildAt(c,1);var d=new PIXI.Graphics;d.beginFill(16248160),d.drawCircle(a.size/2,a.size/2,a.size),d.endFill(),d.alpha=.1,a.graphics.addChildAt(d,2);var e=new PIXI.Graphics;e.beginFill(13582433),e.drawCircle(a.size/2,a.size/2,a.size),e.endFill(),e.alpha=0,a.graphics.addChildAt(e,3),a.graphics.pivot.x=a.size/2,a.graphics.pivot.y=a.size/2,this.addChild(a.graphics)},PixiGame.GameScene.prototype.update=function(){var a=this._player,b=this._enemies.collection,c=PixiGame.controls.state(),d=a.graphics.getChildAt(1),e=a.bullets.collection;c.fire&&this.playerFire();for(var f=function(a,b,c){0>b?a.position[0]=PixiGame.width:b>PixiGame.width&&(a.position[0]=0),0>c?a.position[1]=PixiGame.height:c>PixiGame.height&&(a.position[1]=0)},g=0;g<e.length;g++){var h=e[g];h.graphics.x=h.body.position[0],h.graphics.y=h.body.position[1]}for(var i=0;i<b.length;i++){var j=b[i],k=Math.abs(j.body.position[0]-a.body.position[0]),l=Math.abs(j.body.position[1]-a.body.position[1]),m=Math.atan(l/k);m+Math.PI/2;j.graphics.x=j.body.position[0],j.graphics.y=j.body.position[1],f(j.body,j.body.position[0],j.body.position[1])}if(c.left?a.body.angularVelocity=-1*a.turnSpeed:c.right?a.body.angularVelocity=a.turnSpeed:a.body.angularVelocity=0,c.up){var n=a.body.angle+Math.PI/2;a.body.force[0]-=a.speed*Math.cos(n),a.body.force[1]-=a.speed*Math.sin(n),d.alpha=1}else d.alpha=0;var o=a.body.position[0],p=a.body.position[1];f(a.body,o,p),a.graphics.x=a.body.position[0],a.graphics.y=a.body.position[1],a.graphics.rotation=a.body.angle,PixiGame.world.on("beginContact",function(c){var d=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d].body.id===b||a[d].body.id===c)return!0;return!1};if(c.bodyB.id===a.body.id||c.bodyA.id===a.body.id){var e=a.graphics.getChildAt(3);e.alpha=.25,d(b,c.bodyA.id,c.bodyB.id)&&this.hud().health.update(-.1)}for(var f=0;f<b.length;f++){var g=b[f];if((c.bodyB.id===g.body.id||c.bodyA.id===g.body.id)&&d(a.bullets.collection,c.bodyA.id,c.bodyB.id)){g.graphics.alpha=.1;var h=b.splice(f,1)[0];this.removeChild(h.graphics),this._enemies.amount--,this.hud().score.update(5)}}}.bind(this)),PixiGame.world.on("endContact",function(b){if(b.bodyB.id===a.body.id||b.bodyA.id===a.body.id){var c=a.graphics.getChildAt(3);c.alpha=0}}.bind(this)),a.health<0&&(console.log("game over"),PixiGame.score=a.score,this.gameEnd())},PixiGame.GameScene.prototype.gameEnd=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.EndGameScene)},PixiGame.GameScene.prototype.destroy=function(){this.removeChildren()},PixiGame.RPGScene=function(){PIXI.Graphics.call(this),this._menu=PixiGame.BaseScene.menu(this),this._colorMap={neutral:12113500,good:6084227,evil:14048377},this.setup()},PixiGame.RPGScene.constructor=PixiGame.GameScene,PixiGame.RPGScene.prototype=Object.create(PIXI.Graphics.prototype),PixiGame.RPGScene.prototype.setup=function(){this.setupConvo(),this.setupResponse()},PixiGame.RPGScene.prototype.setupResponse=function(){this._responseText=new PIXI.Text("adsf",{align:"center"}),this._responseText.x=0,this._responseText.y=60,this.addChild(this._responseText)},PixiGame.RPGScene.prototype.setupConvo=function(){for(var a=2*PixiGame.width/3,b=[{"class":"neutral",text:"Which way to the sun?"},{"class":"evil",text:"If you tell me where the sun \nis, I won't kill you."},{"class":"good",text:"Help me help you."}],c=new PIXI.Container,d=0;d<b.length;d++){console.log("convo[i]: "+b[d]);var e=this.createConvoOption(b[d],d);c.addChildAt(e,d)}c.x=a,this.addChild(c)},PixiGame.RPGScene.prototype.createConvoOption=function(a,b){var c=60,d=PixiGame.width/3,e=5,f=new PIXI.Container,g=new PIXI.Graphics;g.beginFill(16777215),g.lineStyle(e,this._colorMap[a["class"]]),g.drawRect(0,0,d,c-e),g.endFill(),g.y=c*b,f.addChildAt(g,0);var h=new PIXI.Text(a.text,{font:"20px Lucia Console",fill:this._colorMap[a["class"]],align:"center"});return h.x=e,h.y=c*b+e,h.wordWrap=!0,h.wordWrapWidth=d,f.addChildAt(h,1),f.interactive=!0,f.touchstart=f.mousedown=this.handleConvoOptionTouch.bind(this),f.oid=b,f},PixiGame.RPGScene.prototype.handleConvoOptionTouch=function(a){var b=[{"class":"neutral",text:"I'm reluctant, but okay."},{"class":"evil",text:"I will kill you!"},{"class":"good",text:"Let me help you."}],c=b[a.target.oid];this._responseText.text=c.text,this._responseText.style.fill="#"+this._colorMap[c["class"]].toString(16),console.log("this._colorMap[response.class].toString(16): "+this._colorMap[c["class"]].toString(16))},PixiGame.RPGScene.prototype.update=function(){},PixiGame.RPGScene.prototype.gameEnd=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.MainMenuScene)},PixiGame.RPGScene.prototype.destroy=function(){this.removeChildren()},PixiGame.CombatScene=function(){PIXI.Graphics.call(this),this._hud=PixiGame.BaseScene.hud(this),this._menu=PixiGame.BaseScene.menu(this),this._log=PixiGame.BaseScene.log(this),this._turn=PixiGame.BaseScene.turn(this),this._player={name:"Player",health:100,maxHealth:100},this._enemy={name:"Enemy",health:100,maxHealth:100},this._attacks=[{text:"laser 5 - 10",min:5,max:10,action:this.handleCombatOptionTouch.bind(this)},{text:"missile 1 - 20",min:1,max:20,action:this.handleCombatOptionTouch.bind(this)},{text:"sabotage 7",min:7,max:7,action:this.handleCombatOptionTouch.bind(this)}],this._combatContainer={},this.setup()},PixiGame.CombatScene.constructor=PixiGame.CombatScene,PixiGame.CombatScene.prototype=Object.create(PIXI.Graphics.prototype),PixiGame.CombatScene.prototype.setup=function(){this.setupCombat(),this.setupAllHealth()},PixiGame.CombatScene.prototype.setupAllHealth=function(){this.setupHealth(this._player,this._menu.sizeX+3*this._hud.margin,PixiGame.height-50-this._hud.margin),this.setupHealth(this._enemy,2*PixiGame.width/3,0)},PixiGame.CombatScene.prototype.setupHealth=function(a,b,c){var d,e=5,f=PixiGame.width/3,g=50,h=new PIXI.Container,i=new PIXI.Graphics,j=new PIXI.Graphics;a.healthDraw=function(){var k=Utils.Colors.health();i.beginFill(k.max),i.lineStyle(e,k.border),i.drawRect(0,0,f,g),i.endFill(),h.addChildAt(i,0),j.beginFill(k.actual),j.lineStyle(e,k.border),j.drawRect(0,0,f,g),j.endFill(),h.addChildAt(j,1),d=new PIXI.Text(""+a.name,{font:"24px Arial",fill:k.font,align:"center",wordWrap:!0,wordWrapWidth:f}),d.x=5,d.y=g/3,h.addChildAt(d,2),h.x=b,h.y=c,this.addChild(h)}.bind(this),a.healthDraw(),a.updateHealth=function(b){a.health-=b,a.health>=0?j.width=a.health/a.maxHealth*f:j.width=0,this._log.updateDamage(a.name+" damaged for "+b+"!!")}.bind(this)},PixiGame.CombatScene.prototype.setupCombat=function(){for(var a=(2*PixiGame.width/3,new PIXI.Container),b=60,c=PixiGame.width/3,d=0;d<this._attacks.length;d++){var e=Utils.OptionFactory.createOption(this._attacks[d],d,b,c,"attack");a.addChildAt(e,d)}a.x=2*PixiGame.width/3-this._hud.margin,a.y=2*PixiGame.height/3+this._hud.margin,this.addChild(a),a.turnActive=this._playerTurn,a.active=function(b){var c=a.children;if(b){a.interactive=!0,a.alpha=1;for(var d=0;d<c.length;d++)c[d].interactive=!0}else{a.interactive=!1,a.alpha=.5;for(var e=0;e<c.length;e++)c[e].interactive=!1}},this._combatContainer=a},PixiGame.CombatScene.prototype.handleCombatOptionTouch=function(a){var b=a.target.meta.min,c=a.target.meta.max,d=Math.floor(Math.random()*(c-b+1))+b;this._log.updateAction(this._player.name+" performs "+a.target.meta.text),this._enemy.updateHealth(d),this._turn.update(!1),this.enemyTurn()},PixiGame.CombatScene.prototype.enemyTurn=function(a){var b=500,c=1,d=this._attacks.length,e=Math.floor(Math.random()*(d-c+1))+c,f=this._attacks[e-1],g=f.min,h=f.max,i=Math.floor(Math.random()*(h-g+1))+g;window.setTimeout(function(){this._player.updateHealth(i),this._log.updateAction(this._enemy.name+" performs "+f.text),this._turn.update(!0)}.bind(this),b)},PixiGame.CombatScene.prototype.update=function(){this._player.health<=0},PixiGame.CombatScene.prototype.gameEnd=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.MainMenuScene)},PixiGame.CombatScene.prototype.destroy=function(){this.removeChildren()},PixiGame.EndGameScene=function(){PIXI.Graphics.call(this),this._playButton=null,this.setup()},PixiGame.EndGameScene.constructor=PixiGame.EndGameScene,PixiGame.EndGameScene.prototype=Object.create(PIXI.Graphics.prototype),PixiGame.EndGameScene.prototype.setup=function(){this._playButton=new PIXI.Sprite.fromImage("images/game/play-game-btn.png"),this._playButton.anchor=new PIXI.Point(.5,.5),this._playButton.position.x=PixiGame.width/2,this._playButton.position.y=PixiGame.height/2,this._playButton.interactive=!0,this._playButton.touchstart=this._playButton.mousedown=this.handlePlayButtonPressed.bind(this),console.log("this: "+this),this.addChild(this._playButton);var a=new PIXI.Text("Current Score: "+PixiGame.score,{font:"24px Arial",fill:16715792,align:"center"});if(a.x=PixiGame.width/2-30,a.y=PixiGame.height/2-100,this.addChildAt(a,0),PixiGame.score>PixiGame.highScore){PixiGame.highScore=PixiGame.score;var b=new PIXI.Text("New High Score!",{font:"24px Arial",fill:16715792,align:"center"});b.x=PixiGame.width/2-30,b.y=PixiGame.height/2-150,this.addChildAt(b,0)}var c=new PIXI.Text("High Score: "+PixiGame.score,{font:"24px Arial",fill:16715792,align:"center"});c.x=PixiGame.width/2-30,c.y=PixiGame.height/2-200,this.addChildAt(c,0)},PixiGame.EndGameScene.prototype.handlePlayButtonPressed=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.GameScene)},PixiGame.EndGameScene.prototype.update=function(){},PixiGame.EndGameScene.prototype.destroy=function(){this.removeChildren(),this._playButton=null},document.addEventListener("DOMContentLoaded",function(){PixiGame.width=document.documentElement.clientWidth,PixiGame.height=document.documentElement.clientHeight,PixiGame.renderer=new PIXI.autoDetectRenderer(PixiGame.width,PixiGame.height),PixiGame.renderer.view.setAttribute("class","renderer"),document.body.appendChild(PixiGame.renderer.view),PixiGame.stage=new PIXI.Container,PixiGame.world=new p2.World({gravity:[0,0]}),PixiGame.controls=new PixiGame.Controller,PixiGame.sceneController=new PixiGame.SceneController(PixiGame.MainMenuScene),PixiGame.score=0,PixiGame.highScore=0,PixiGame.Synth.init(),PixiGame.gameLoopController=new PixiGame.GameLoopController,PixiGame.gameLoopController.start()});