"use strict";var PixiGame=PixiGame||{};PixiGame.stage=null,PixiGame.renderer=null,PixiGame.gameLoopController=null,PixiGame.sceneController=null,PixiGame.world=null,PixiGame.controls=null,PixiGame.Controller=function(a){this._state={left:!1,right:!1,up:!1,fire:!1},this.setupPlayerControls()},PixiGame.Controller.constructor=PixiGame.Controller,PixiGame.Controller.prototype.setupPlayerControls=function(){window.addEventListener("keydown",function(a){this.changeControls(a.keyCode,!0)}.bind(this),!1),window.addEventListener("keyup",function(a){this.changeControls(a.keyCode,!1)}.bind(this),!1)},PixiGame.Controller.prototype.changeControls=function(a,b){switch(a){case 37:this._state.left=b;break;case 39:this._state.right=b;break;case 38:this._state.up=b;break;case 32:this._state.fire=b}},PixiGame.Controller.prototype.state=function(){return this._state},PixiGame.GameLoopController=function(){this._isGameActive=!1,this._fps=60,this._updateInterval=null},PixiGame.GameLoopController.constructor=PixiGame.GameLoopController,PixiGame.GameLoopController.prototype.tick=function(){this._isGameActive&&(requestAnimationFrame(this.tick.bind(this)),PixiGame.sceneController.update(),PixiGame.world.step(1/this._fps),PixiGame.renderer.render(PixiGame.stage))},PixiGame.GameLoopController.prototype.start=function(){this._isGameActive||(this._isGameActive=!0,this.tick())},PixiGame.GameLoopController.prototype.pause=function(){this._isGameActive&&(clearInterval(this._updateInterval),this._isGameActive=!1)},Object.defineProperty(PixiGame.GameLoopController.prototype,"isPaused",{get:function(){return!this._isGameActive}}),PixiGame.SceneController=function(a){this._currentScene=new a,this._previousScene=null,PixiGame.stage.addChild(this._currentScene)},PixiGame.SceneController.constructor=PixiGame.SceneController,PixiGame.SceneController.prototype.update=function(){this._currentScene.update()},PixiGame.SceneController.prototype.requestSceneChange=function(a){null!==this._currentScene&&(this._previousScene=this._currentScene,this._previousScene.destroy(),PixiGame.stage.removeChild(this._previousScene)),this._currentScene=new a,PixiGame.stage.addChild(this._currentScene)},PixiGame.MainMenuScene=function(){PIXI.Graphics.call(this),this._playButton=null,this.setup()},PixiGame.MainMenuScene.constructor=PixiGame.MainMenuScene,PixiGame.MainMenuScene.prototype=Object.create(PIXI.Graphics.prototype),PixiGame.MainMenuScene.prototype.setup=function(){var a=new PIXI.Text("Evolution",{font:"48px Arial",fill:16715792,align:"center"});a.x=PixiGame.width/2-30,a.y=PixiGame.height/2-100,this.addChildAt(a,0),this._playButton=new PIXI.Sprite.fromImage("images/game/play-game-btn.png"),this._playButton.anchor=new PIXI.Point(.5,.5),this._playButton.position.x=PixiGame.width/2,this._playButton.position.y=PixiGame.height/2,this._playButton.interactive=!0,this._playButton.touchstart=this._playButton.mousedown=this.handlePlayButtonPressed.bind(this),console.log("this: "+this),this.addChild(this._playButton)},PixiGame.MainMenuScene.prototype.handlePlayButtonPressed=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.GameScene)},PixiGame.MainMenuScene.prototype.update=function(){},PixiGame.MainMenuScene.prototype.destroy=function(){this.removeChildren(),this._playButton=null},PixiGame.GameScene=function(){PIXI.Graphics.call(this),this._player={score:0,health:100,body:null,shape:null,graphics:null,size:50,speed:100,turnSpeed:2,bullets:{collection:[],speed:50,max:1,size:5}},this._enemies={collection:[],speed:75,size:50,amount:0,max:10},this.setup()},PixiGame.GameScene.constructor=PixiGame.GameScene,PixiGame.GameScene.prototype=Object.create(PIXI.Graphics.prototype),PixiGame.GameScene.prototype.setup=function(){this.hud().setup(),this.setupPlayer(),this.setupEnemies()},PixiGame.GameScene.prototype.hud=function(){var a=this,b={position:[20,20],setup:function(){var b=new PIXI.Container;b.x=this.position[0],b.y=this.position[1],this.score.redraw(b),this.health.redraw(b),a.addChildAt(b,0)},score:{text:"Score: ",update:function(b){a._player.score+=b,a.getChildAt(0).getChildAt(0).text=this.text+a._player.score},redraw:function(b){var c=new PIXI.Text(this.text+a._player.score,{font:"24px Arial",fill:16715792,align:"center"});b.addChildAt(c,0)}},health:{text:"Health: ",update:function(b){a._player.health+=b,a.getChildAt(0).getChildAt(1).text=this.text+Math.round(a._player.health)},redraw:function(b){var c=new PIXI.Text(this.text+a._player.health,{font:"24px Arial",fill:16715792,align:"center"});c.y=25,b.addChildAt(c,1)}}};return b},PixiGame.GameScene.prototype.playerFire=function(){var a=1.5*this._player.speed,b=this._player.body.angle-Math.PI/2,c={graphics:new PIXI.Graphics,body:new p2.Body({mass:0,damping:0,angularDamping:0}),active:!1};c.body.velocity[0]+=a*Math.cos(b)+this._player.body.velocity[0],c.body.velocity[1]+=a*Math.sin(b)+this._player.body.velocity[1],c.body.position[0]=this._player.size/2*Math.cos(b)+this._player.body.position[0],c.body.position[1]=this._player.size/2*Math.sin(b)+this._player.body.position[1];var d=new p2.Circle({radius:this._player.bullets.size});c.body.addShape(d),PixiGame.world.addBody(c.body),c.graphics.beginFill(16777215),c.graphics.lineStyle(1,16711680),c.graphics.drawRect(0,0,this._player.bullets.size,this._player.bullets.size),c.graphics.drawCircle(0,0,this._player.bullets.size),c.graphics.endFill(),this.addChild(c.graphics),this._player.bullets.collection.push(c)},PixiGame.GameScene.prototype.setupEnemies=function(){var a=this._enemies;setInterval(function(){if(!(a.amount>=a.max)){var b=Math.round(Math.random()*PixiGame.width),c=Math.round(Math.random()*PixiGame.height),d=(Math.random()-.5)*a.speed,e=(Math.random()-.5)*a.speed,f=(Math.random()-.5)*a.speed,g={body:new p2.Body({position:[b,c],mass:.1,damping:0,angularDamping:0,velocity:[d,e],angularVelocity:f}),graphics:new PIXI.Container},h=new p2.Circle({radius:a.size});g.body.addShape(h),PixiGame.world.addBody(g.body);var i=new PIXI.Graphics;i.beginFill(8054410),i.drawCircle(0,0,a.size),i.endFill(),g.graphics.addChild(i),this.addChild(g.graphics),a.collection.push(g),a.amount++}}.bind(this),1e3)},PixiGame.GameScene.prototype.setupPlayerBullets=function(){for(var a=(this._player,this._player.bullets),b=300,c=300,d=0;d<a.max;d++)a.bodies[d]=new p2.Body({mass:1,angularVelocity:0,damping:0,angularDamping:0,position:[b,c]}),a.shapes[d]=new p2.Box({width:a.size,height:a.size}),a.bodies[d].addShape(a.shapes[d]),PixiGame.world.addBody(a.bodies[d]),a.graphics[d]=new PIXI.Graphics,a.graphics[d].beginFill(16777215),a.graphics[d].lineStyle(5,16711680),a.graphics[d].drawRect(b,c,a.size,a.size),a.graphics[d].endFill(),this.addChild(a.graphics[d])},PixiGame.GameScene.prototype.setupPlayer=function(){var a=this._player;a.body=new p2.Body({mass:1,angularVelocity:0,damping:0,angularDamping:0,position:[PixiGame.width/2,PixiGame.height/2]}),a.shape=new p2.Box({width:a.size,height:a.size}),a.body.addShape(a.shape),PixiGame.world.addBody(a.body),a.graphics=new PIXI.Container;var b=new PIXI.Graphics;b.beginFill(12240598),b.moveTo(0,a.size),b.lineTo(0,a.size*(2/3)),b.lineTo(a.size/2,0),b.lineTo(a.size,a.size*(2/3)),b.lineTo(a.size,a.size),b.lineTo(a.size*(2/3),a.size*(2/3)),b.lineTo(a.size*(1/3),a.size*(2/3)),b.endFill(),a.graphics.addChildAt(b,0);var c=new PIXI.Graphics;c.beginFill(16248160),c.moveTo(a.size*(1/3),a.size*(2/3)),c.lineTo(a.size*(2/3),a.size*(2/3)),c.lineTo(.5*a.size,a.size),c.endFill(),c.alpha=0,a.graphics.addChildAt(c,1);var d=new PIXI.Graphics;d.beginFill(16248160),d.drawCircle(a.size/2,a.size/2,a.size),d.endFill(),d.alpha=.1,a.graphics.addChildAt(d,2);var e=new PIXI.Graphics;e.beginFill(13582433),e.drawCircle(a.size/2,a.size/2,a.size),e.endFill(),e.alpha=0,a.graphics.addChildAt(e,3),a.graphics.pivot.x=a.size/2,a.graphics.pivot.y=a.size/2,this.addChild(a.graphics)},PixiGame.GameScene.prototype.update=function(){var a=this._player,b=this._enemies.collection,c=PixiGame.controls.state(),d=a.graphics.getChildAt(1),e=a.bullets.collection;c.fire&&this.playerFire();for(var f=function(a,b,c){0>b?a.position[0]=PixiGame.width:b>PixiGame.width&&(a.position[0]=0),0>c?a.position[1]=PixiGame.height:c>PixiGame.height&&(a.position[1]=0)},g=0;g<e.length;g++){var h=e[g];h.graphics.x=h.body.position[0],h.graphics.y=h.body.position[1]}for(var i=0;i<b.length;i++){var j=b[i],k=Math.abs(j.body.position[0]-a.body.position[0]),l=Math.abs(j.body.position[1]-a.body.position[1]),m=Math.atan(l/k);m+Math.PI/2;j.graphics.x=j.body.position[0],j.graphics.y=j.body.position[1],f(j.body,j.body.position[0],j.body.position[1])}if(c.left?a.body.angularVelocity=-1*a.turnSpeed:c.right?a.body.angularVelocity=a.turnSpeed:a.body.angularVelocity=0,c.up){var n=a.body.angle+Math.PI/2;a.body.force[0]-=a.speed*Math.cos(n),a.body.force[1]-=a.speed*Math.sin(n),d.alpha=1}else d.alpha=0;var o=a.body.position[0],p=a.body.position[1];f(a.body,o,p),a.graphics.x=a.body.position[0],a.graphics.y=a.body.position[1],a.graphics.rotation=a.body.angle,PixiGame.world.on("beginContact",function(c){var d=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d].body.id===b||a[d].body.id===c)return!0;return!1};if(c.bodyB.id===a.body.id||c.bodyA.id===a.body.id){var e=a.graphics.getChildAt(3);e.alpha=.25,d(b,c.bodyA.id,c.bodyB.id)&&this.hud().health.update(-.1)}for(var f=0;f<b.length;f++){var g=b[f];if((c.bodyB.id===g.body.id||c.bodyA.id===g.body.id)&&d(a.bullets.collection,c.bodyA.id,c.bodyB.id)){g.graphics.alpha=.1;var h=b.splice(f,1)[0];this.removeChild(h.graphics),this._enemies.amount--,this.hud().score.update(5)}}}.bind(this)),PixiGame.world.on("endContact",function(b){if(b.bodyB.id===a.body.id||b.bodyA.id===a.body.id){var c=a.graphics.getChildAt(3);c.alpha=0}}.bind(this)),a.health<0&&(console.log("game over"),PixiGame.score=a.score,this.gameEnd())},PixiGame.GameScene.prototype.gameEnd=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.EndGameScene)},PixiGame.GameScene.prototype.destroy=function(){this.removeChildren()},PixiGame.EndGameScene=function(){PIXI.Graphics.call(this),this._playButton=null,this.setup()},PixiGame.EndGameScene.constructor=PixiGame.EndGameScene,PixiGame.EndGameScene.prototype=Object.create(PIXI.Graphics.prototype),PixiGame.EndGameScene.prototype.setup=function(){this._playButton=new PIXI.Sprite.fromImage("images/game/play-game-btn.png"),this._playButton.anchor=new PIXI.Point(.5,.5),this._playButton.position.x=PixiGame.width/2,this._playButton.position.y=PixiGame.height/2,this._playButton.interactive=!0,this._playButton.touchstart=this._playButton.mousedown=this.handlePlayButtonPressed.bind(this),console.log("this: "+this),this.addChild(this._playButton);var a=new PIXI.Text("Current Score: "+PixiGame.score,{font:"24px Arial",fill:16715792,align:"center"});if(a.x=PixiGame.width/2-30,a.y=PixiGame.height/2-100,this.addChildAt(a,0),PixiGame.score>PixiGame.highScore){PixiGame.highScore=PixiGame.score;var b=new PIXI.Text("New High Score!",{font:"24px Arial",fill:16715792,align:"center"});b.x=PixiGame.width/2-30,b.y=PixiGame.height/2-150,this.addChildAt(b,0)}var c=new PIXI.Text("High Score: "+PixiGame.score,{font:"24px Arial",fill:16715792,align:"center"});c.x=PixiGame.width/2-30,c.y=PixiGame.height/2-200,this.addChildAt(c,0)},PixiGame.EndGameScene.prototype.handlePlayButtonPressed=function(a){PixiGame.sceneController.requestSceneChange(PixiGame.GameScene)},PixiGame.EndGameScene.prototype.update=function(){},PixiGame.EndGameScene.prototype.destroy=function(){this.removeChildren(),this._playButton=null},document.addEventListener("DOMContentLoaded",function(){PixiGame.width=document.documentElement.clientWidth,PixiGame.height=document.documentElement.clientHeight,PixiGame.renderer=new PIXI.autoDetectRenderer(PixiGame.width,PixiGame.height),PixiGame.renderer.view.setAttribute("class","renderer"),document.body.appendChild(PixiGame.renderer.view),PixiGame.stage=new PIXI.Container,PixiGame.world=new p2.World({gravity:[0,0]}),PixiGame.controls=new PixiGame.Controller,PixiGame.sceneController=new PixiGame.SceneController(PixiGame.MainMenuScene),PixiGame.score=0,PixiGame.highScore=0,PixiGame.gameLoopController=new PixiGame.GameLoopController,PixiGame.gameLoopController.start()});