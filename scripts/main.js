"use strict";function createScore(){var e;e=new createjs.Text("Score: "+score,"24px Arial","white"),e.x=5,e.y=10,e.alpha=.9,e.name="scoreLabel",stage.addChild(e);var a;a=new createjs.Text("Rings: "+goalsHit+"/"+GOALS,"24px Arial","gold"),a.x=5,a.y=40,a.alpha=.9,a.name="goalLabel",stage.addChild(a)}function createInterfaceContainer(){var e=new createjs.Shape;e.name="ui",e.graphics.beginFill("white").drawRect(15,floor+10,50,-INDICATOR_HEIGHT-20),e.alpha=.5,stage.addChild(e)}function createHealth(){var e=new createjs.Shape;e.name="health",e.on("tick",function(a){if(!a.paused){var t=player.health*INDICATOR_HEIGHT/FULL_HEALTH;e.graphics.clear(),e.graphics.beginFill("red").drawRect(25,floor,5,-t)}}),stage.addChild(e)}function createAmmo(){var e=new createjs.Shape;e.name="ammo",e.on("tick",function(a){if(!a.paused){var t=(MAX_BULLETS-activeBulletCount)*INDICATOR_HEIGHT/MAX_BULLETS;e.graphics.clear(),e.graphics.beginFill("black").drawRect(50,floor,5,-t)}}),stage.addChild(e)}function createObstacleBullets(){oBullets=new createjs.Container,oBullets.name="oBullets";for(var e=200,a=0;e>a;a++){var t=new createjs.Shape;t.name="ob:"+a,t.graphics.setStrokeStyle(2),t.graphics.beginStroke("red"),t.graphics.drawCircle(0,0,5),t.active=!1,oBullets.addChild(t)}stage.addChild(oBullets),bullets.on("tick",function(e){if(!e.paused){var a=obstacles.children.length,t=obstacles.children[getRandomInt(0,a)],l=getRandomInt(0,oBullets.children.length),r=oBullets.children[l];t.alpha>0&&!r.active&&obstacles.x+t.leftx<wall&&(r.active=!0,r.x=obstacles.x+t.x+t.leftx,r.y=obstacles.y+t.y+t.middle-t.bottomy);for(var o=0;o<oBullets.children.length;o++){var n=oBullets.children[o];n.active&&(n.alpha=1,n.x-=5),n.x<=-50&&(n.active=!1,n.alpha=1)}}})}function getRandomInt(e,a){return Math.floor(Math.random()*(a-e))+e}function createBullets(){bullets=new createjs.Container;for(var e=0;MAX_BULLETS>e;e++){var a=new createjs.Shape;a.name="bullet:"+e,a.graphics.setStrokeStyle(2),a.graphics.beginStroke("white"),a.graphics.drawCircle(0,0,5),a.active=!1,a.alpha=0,bullets.addChild(a)}stage.addChild(bullets),bullets.on("tick",function(e){if(!e.paused)for(var a=0;a<bullets.children.length;a++){var t=bullets.children[a];t.active&&(t.alpha=1,t.x+=5),t.x>=wall&&(t.active=!1,t.x=player.x,t.y=player.y,t.alpha=0,activeBulletCount--)}})}function createPlayer(){var e=.8,a=4,t=0,l=0;player=new createjs.Container,player.name="player",player.health=FULL_HEALTH;var r=new createjs.Shape;r.graphics.beginFill("white").drawRect(-2.5,-2.5,5,5);var o=new createjs.Shape;o.graphics.beginFill("purple").drawRect(-5,-5,10,10);var n=new createjs.Shape;n.graphics.beginFill("white").drawRect(-10,-10,20,20),player.x=200,player.y=floor-50,player.addChild(n),player.addChild(o),player.addChild(r),stage.addChild(player),player.on("tick",function(r){if(!r.paused){keys[38]&&l>-a&&l--,keys[40]&&a>l&&l++,keys[39]&&a>t&&t++,keys[37]&&t>-a&&t--,l*=e,player.y+=l,t*=e,player.x+=t}}),player.explode=function(){var e,a;e=player.getChildByName("littleExplode"),a=player.getChildByName("bigExplode"),e||(e=new createjs.Shape,e.alpha=1),e.graphics.setStrokeStyle(2),e.graphics.beginStroke("yellow"),e.graphics.drawCircle(0,0,20),e.name="littleExplode",a||(a=new createjs.Shape,a.alpha=1),a.graphics.setStrokeStyle(2),a.graphics.beginStroke("red"),a.graphics.drawCircle(0,0,30),a.name="bigExplode",player.addChild(e),player.addChild(a)},player.notExplode=function(){var e=player.getChildByName("littleExplode"),a=player.getChildByName("bigExplode");player.removeChild(e),player.removeChild(a)},player.fire=function(){MAX_BULLETS>activeBulletCount&&(activeBulletCount++,bullets.children[activeBulletCount].active=!0,bullets.children[activeBulletCount].x=player.x,bullets.children[activeBulletCount].y=player.y)}}function createCircle(){circleContainer=new createjs.Container;var e=new createjs.Shape;e.graphics.setStrokeStyle(3),e.graphics.beginStroke("yellow"),e.graphics.moveTo(0,20),e.graphics.lineTo(0,40),e.graphics.endStroke(),e.name="line";var a=new createjs.Shape;a.graphics.beginFill("red").drawCircle(0,0,10);var t=new createjs.Shape;t.graphics.beginFill("grey").drawCircle(0,0,40),circleContainer.x=50,circleContainer.y=floor,circleContainer.addChild(t),circleContainer.addChild(a),circleContainer.addChild(e),stage.addChild(circleContainer),circleContainer.on("tick",function(a){var t=a,l=t.delta;e.rotation+=l/1e3*100})}function generateGoals(){var e,a,t,l;a=400,t=10,l=500,e=LEVEL_LENGTH||800,goals=new createjs.Container,goals.x=l,goals.y=floor,stage.addChild(goals);for(var r=0;GOALS>r;r++){var o=new createjs.Shape;o.name="goal:"+r,o.graphics.setStrokeStyle(5),o.graphics.beginStroke("gold"),o.graphics.drawCircle(0,0,t),o.x=r*(t+a),o.y=getRandomInt(0,-floor-10),goals.addChild(o)}goals.on("tick",function(a){a.paused||(goals.x-=a.delta/1e3*50,goals.x<=-e&&(goals.x=0))})}function generateObstacles(){var e,a,t,l,r,o,n,c,i,s,d,h,p;d=300,l=20,p=20,o=(wall-d)/(l+p)+d/(l+p),i=3,s=.9,n=0,c=0,h=3,o*=2,obstacles=new createjs.Container,obstacles.name="obstacles",obstacles.x=d,obstacles.y=floor,stage.addChild(obstacles);for(var g,u=0;o>u;u++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=u*(l+p+10),t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+l,l,-l),e.name="o"+u,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.vX=0,e.vY=0,obstacles.addChild(e),e.explode=function(){console.log("explode"),this.alpha=.75},e.notExplode=function(){console.log("not explode"),this.alpha=0},g=a,LEVEL_LENGTH=a;for(u=0;o>u;u++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=u*(l+p),t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+2*l,2*l,3*-l),e.name="2o"+u,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.vX=0,e.vY=0,obstacles.addChild(e),e.explode=function(){console.log("explode"),this.alpha=.75},e.notExplode=function(){console.log("not explode"),this.alpha=0};for(u=0;o>u;u++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=u*(l+p),t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+3*l,3*l,2*-l),e.name="2o"+u,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.vX=0,e.vY=0,obstacles.addChild(e),e.explode=function(){console.log("explode"),this.alpha=.75},e.notExplode=function(){console.log("not explode"),this.alpha=0};obstacles.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;i>n&&n++,i>c&&c++,n*=s,obstacles.x-=n;var l=getRandomInt(0,o*h),r=obstacles.children[l];r.x+=n*(50*t/1e3),r.y-=c*(50*t/1e3),l=getRandomInt(0,o*h),r=obstacles.children[l],r.x-=n*(25*t/1e3),r.y+=c*(25*t/1e3),l=getRandomInt(0,o*h),r=obstacles.children[l],r.x-=n*(25*t/1e3),r.y+=c*(25*t/1e3),obstacles.x<=-g&&(obstacles.x=wall)}})}function generateBackgroundObstacles(){var e,a,t,l,r,o;o=50,l=10;var n=new createjs.Container;n.name="obstacles",n.x=10,n.y=floor,stage.addChild(n);for(var c,i=0;o>i;i++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=30*i,t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+l,l,-l),e.name="o"+i,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.alpha=.5,n.addChild(e),c=a;n.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;n.x-=t/1e3*25,n.x<=-c&&(n.x=0)}})}function generateFarBackgroundObstacles(){var e,a,t,l,r,o;o=50,l=200;var n=new createjs.Container;n.name="obstacles",n.x=400,n.y=floor,stage.addChild(n);for(var c=0;o>c;c++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=30*c,t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+l,l,-l),e.name="o"+c,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.alpha=.25,n.addChild(e);n.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;n.x-=t/1e3*5,n.x<=-500&&(n.x=500)}})}function createStart(){start=new createjs.Container;var e=new createjs.Text("Click to Start","48px Arial","black"),a=new createjs.Text("Collect the rings!","24px Arial","red");a.y=50;var t=new createjs.Shape;t.graphics.beginFill("white").drawRect(0,0,300,100),start.addChild(t),start.addChild(e),start.addChild(a),start.name="start",start.x=200,start.y=floor/2,start.clicked=!1}function createStage(){score=0,stage.removeAllChildren(),generateFarBackgroundObstacles(),generateBackgroundObstacles(),createPlayer(),generateObstacles(),createBullets(),createObstacleBullets(),generateGoals(),createInterfaceContainer(),createHealth(),createAmmo(),createStart(),createScore()}function init(){stage=new createjs.Stage("canvas"),createStage(),addStart(),createjs.Ticker.on("tick",tick)}function handleHitObjects(){for(var e,a=stage.getObjectsUnderPoint(player.x,player.y,0),t=!1,l=0;l<a.length;l++)e=a[l],e.parent===obstacles?t=!0:e.parent===oBullets?t=!0:e.parent===goals&&(e.alpha=0,goalsHit++);obstacles.alpha=t?.5:1,lose=t?!0:!1;for(var r=0;r<bullets.children.length;r++){var o=bullets.children[r];if(o.active)for(var n=stage.getObjectsUnderPoint(o.x,o.y,0),c=!1,i=0;i<n.length;i++)e=n[i],e.parent===obstacles&&(c=!0,console.log("stage hit by bullet"),e.explode(),e.notExplode(),e.alpha=0,o.active=!1,o.x=player.x,o.y=player.y,o.alpha=0,activeBulletCount--,score+=50)}}function tick(e){createjs.Ticker.paused||(testLose(),testWin(),handleHitObjects(),updateScore()),stage.update(e)}function testWin(){if(goalsHit>=GOALS){var e;e=new createjs.Text("You got all the rings! You win!","48px Arial","white"),e.x=50,e.y=80,e.alpha=.9,e.name="winLabel",stage.addChild(e),addStart()}}function updateScore(){var e=stage.getChildByName("scoreLabel");stage.removeChild(e);var a=stage.getChildByName("goalLabel");stage.removeChild(a),createScore()}function playerOutOfBounds(){var e=!1;return(player.x<=0||player.x>=wall||player.y<=0||player.y>=floor+10)&&(e=!0),e}function testLose(){var e,a,t;e=new createjs.Text("Lose","48px Arial","#F00"),e.x=200,e.y=10,e.alpha=.5,e.name="loseLabel",a=new createjs.Text("Killed","48px Arial","#F00"),a.x=300,a.y=10,a.alpha=.5,a.name="killedLabel",lose||playerOutOfBounds()?(player.explode(),player.health-=5):player.notExplode(),player.health<=0&&(t=new createjs.Text("You lasted: "+timer+" seconds","24px Arial","white"),t.x=200,t.y=80,t.alpha=.9,t.name="timerLabel",stage.addChild(t),stage.removeChild(stage.getChildByName("loseLabel")),addStart())}function addStart(){stage.addChild(start),createjs.Ticker.paused=!0,clearInterval(timerInterval),start.on("click",function(){start.clicked=!0,createjs.Ticker.paused=!1,player.health=FULL_HEALTH,activeBulletCount=0,goalsHit=0,createStage(),startTimer()})}function startTimer(){var e=new Date;timerInterval=setInterval(function(){timer=Math.round((new Date-e)/1e3,0)},1e3)}function printMouse(){console.log("stage.mouseX: "+stage.mouseX),console.log("stage.mouseY: "+stage.mouseY),console.log("player.y: "+player.y)}var stage,circleContainer,player,floor,obstacles,lose,start,FULL_HEALTH,timer,timerInterval,bullets,activeBullets,MAX_BULLETS,activeBulletCount,INDICATOR_HEIGHT,oBullets,activeOBulletCount,wall,score,keys,canvas,LEVEL_LENGTH,goals,goalsHit,GOALS;canvas=document.getElementById("canvas"),canvas.width=800,canvas.height=600,keys=[],wall=canvas.width,floor=canvas.height-50,lose=!1,FULL_HEALTH=25,timer=0,activeBullets=[],activeBulletCount=activeOBulletCount=0,MAX_BULLETS=10,INDICATOR_HEIGHT=100,score=0,goalsHit=0,GOALS=5,document.body.addEventListener("keydown",function(e){keys[e.which]=!0,32===e.which&&player.fire(),e.preventDefault()}),document.body.addEventListener("keyup",function(e){keys[e.keyCode]=!1,e.preventDefault()});var colors={map:{0:"red",1:"blue",2:"yellow",3:"cyan",4:"green",5:"white",6:"purple",7:"orange"},count:8};