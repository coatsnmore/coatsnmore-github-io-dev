"use strict";function resetControls(){up=!1,down=!1,left=!1,right=!1,fire=!1}function createScore(){var e;e=new createjs.Text("Score: "+score,"24px Arial","white"),e.x=50,e.y=10,e.alpha=.9,e.name="scoreLabel",stage.addChild(e)}function createHealth(){var e=new createjs.Shape;e.name="health",e.on("tick",function(a){if(!a.paused){var t=player.health*INDICATOR_HEIGHT/FULL_HEALTH;e.graphics.clear(),e.graphics.beginFill("red").drawRect(50,200,5,-t)}}),stage.addChild(e)}function createAmmo(){var e=new createjs.Shape;e.name="ammo",e.on("tick",function(a){if(!a.paused){var t=(MAX_BULLETS-activeBulletCount)*INDICATOR_HEIGHT/MAX_BULLETS;e.graphics.clear(),e.graphics.beginFill("yellow").drawRect(75,200,5,-t)}}),stage.addChild(e)}function createObstacleBullets(){oBullets=new createjs.Container,oBullets.name="oBullets";for(var e=50,a=0;e>a;a++){var t=new createjs.Shape;t.name="ob:"+a,t.graphics.setStrokeStyle(2),t.graphics.beginStroke("red"),t.graphics.drawCircle(0,0,5),t.active=!1,oBullets.addChild(t)}stage.addChild(oBullets),bullets.on("tick",function(e){if(!e.paused){var a=obstacles.children.length,t=obstacles.children[getRandomInt(0,a)],l=getRandomInt(0,oBullets.children.length),r=oBullets.children[l];t.alpha>0&&!r.active&&obstacles.x+t.leftx<wall&&(r.active=!0,r.x=obstacles.x+t.leftx,r.y=obstacles.y+t.middle-t.bottomy);for(var o=0;o<oBullets.children.length;o++){var i=oBullets.children[o];i.active&&(i.alpha=1,i.x-=5),i.x<=-50&&(i.active=!1,i.alpha=1)}}})}function getRandomInt(e,a){return Math.floor(Math.random()*(a-e))+e}function createBullets(){bullets=new createjs.Container;for(var e=0;MAX_BULLETS>e;e++){var a=new createjs.Shape;a.name="bullet:"+e,a.graphics.setStrokeStyle(2),a.graphics.beginStroke("white"),a.graphics.drawCircle(0,0,5),a.active=!1,a.alpha=0,bullets.addChild(a)}stage.addChild(bullets),bullets.on("tick",function(e){if(!e.paused)for(var a=0;a<bullets.children.length;a++){var t=bullets.children[a];t.active&&(t.alpha=1,t.x+=5),t.x>=500&&(t.active=!1,t.x=player.x,t.y=player.y,t.alpha=0,activeBulletCount--)}})}function createPlayer(){player=new createjs.Container,player.name="player",player.health=FULL_HEALTH;var e=new createjs.Shape;e.graphics.beginFill("white").drawRect(-2.5,-2.5,5,5);var a=new createjs.Shape;a.graphics.beginFill("purple").drawRect(-5,-5,10,10);var t=new createjs.Shape;t.graphics.beginFill("white").drawRect(-10,-10,20,20),circleContainer=new createjs.Container,player.x=200,player.y=floor-50,player.addChild(t),player.addChild(a),player.addChild(e),stage.addChild(player),player.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;up?player.y-=t/1e3*100:left?player.x-=t/1e3*100:right?player.x+=t/1e3*100:down?player.y+=t/1e3*100:player.y<floor}}),player.explode=function(){var e,a;e=player.getChildByName("littleExplode"),a=player.getChildByName("bigExplode"),e||(e=new createjs.Shape,e.alpha=1),e.graphics.setStrokeStyle(2),e.graphics.beginStroke("yellow"),e.graphics.drawCircle(0,0,20),e.name="littleExplode",a||(a=new createjs.Shape,a.alpha=1),a.graphics.setStrokeStyle(2),a.graphics.beginStroke("red"),a.graphics.drawCircle(0,0,30),a.name="bigExplode",player.addChild(e),player.addChild(a)},player.notExplode=function(){var e=player.getChildByName("littleExplode"),a=player.getChildByName("bigExplode");player.removeChild(e),player.removeChild(a)}}function createCircle(){var e=new createjs.Shape;e.graphics.setStrokeStyle(3),e.graphics.beginStroke("yellow"),e.graphics.moveTo(0,20),e.graphics.lineTo(0,40),e.graphics.endStroke(),e.name="line";var a=new createjs.Shape;a.graphics.beginFill("red").drawCircle(0,0,10);var t=new createjs.Shape;t.graphics.beginFill("grey").drawCircle(0,0,40),circleContainer.x=50,circleContainer.y=floor,circleContainer.addChild(t),circleContainer.addChild(a),circleContainer.addChild(e),stage.addChild(circleContainer),circleContainer.on("tick",function(a){var t=a,l=t.delta;e.rotation+=l/1e3*100})}function generateObstacles(){var e,a,t,l,r,o;o=100,l=20,obstacles=new createjs.Container,obstacles.name="obstacles",obstacles.x=400,obstacles.y=floor,stage.addChild(obstacles);for(var i=0;o>i;i++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=i*(l+10),t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+l,l,-l),e.name="o"+i,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,obstacles.addChild(e);obstacles.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;obstacles.x-=t/1e3*50,obstacles.x<=-(o*(l+10))&&(obstacles.x=wall)}})}function generateBackgroundObstacles(){var e,a,t,l,r,o;o=50,l=10;var i=new createjs.Container;i.name="obstacles",i.x=400,i.y=floor,stage.addChild(i);for(var c=0;o>c;c++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=30*c,t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+l,l,-l),e.name="o"+c,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.alpha=.5,i.addChild(e);i.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;i.x-=t/1e3*25,i.x<=-500&&(i.x=500)}})}function generateFarBackgroundObstacles(){var e,a,t,l,r,o;o=50,l=200;var i=new createjs.Container;i.name="obstacles",i.x=400,i.y=floor,stage.addChild(i);for(var c=0;o>c;c++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=30*c,t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+l,l,-l),e.name="o"+c,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.alpha=.25,i.addChild(e);i.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;i.x-=t/1e3*5,i.x<=-500&&(i.x=500)}})}function createObstacles(){obstacles=new createjs.Container,obstacles.name="obstacles";var e=new createjs.Shape;e.graphics.beginFill("blue").drawRect(0,0,50,-100),e.name="o1",e.leftx=0,e.middle=50,e.bottomy=0;var a=new createjs.Shape;a.graphics.beginFill("yellow").drawRect(100,-100,50,-50),a.name="o2",a.middle=25,a.leftx=100,a.bottomy=100;var t=new createjs.Shape;t.graphics.beginFill("green").drawRect(200,0,50,-100),t.name="o3",t.middle=50,t.leftx=200,t.bottomy=0;var l=new createjs.Shape;l.graphics.beginFill("blue").drawRect(300,-150,50,-50),l.name="o4",l.middle=25,l.leftx=300,l.bottomy=150;var r=new createjs.Shape;r.graphics.beginFill("green").drawRect(400,-150,50,-50),r.name="o5",r.middle=25,r.leftx=400,r.bottomy=150;var o=new createjs.Shape;o.graphics.beginFill("cyan").drawRect(500,-150,50,-100),o.name="o6",o.middle=50,o.leftx=500,o.bottomy=150;var i=new createjs.Shape;i.graphics.beginFill("blue").drawRect(600,-100,50,-150),i.name="o7",i.middle=75,i.leftx=600,i.bottomy=100;var c=new createjs.Shape;c.graphics.beginFill("green").drawRect(700,-100,-50,-50),c.name="o8",c.middle=25,c.leftx=700,c.bottomy=100;var n=new createjs.Shape;n.graphics.beginFill("blue").drawRect(800,-100,50,-150),n.name="o9",n.middle=75,n.leftx=800,n.bottomy=100,obstacles.x=400,obstacles.y=floor,obstacles.addChild(e),obstacles.addChild(a),obstacles.addChild(t),obstacles.addChild(l),obstacles.addChild(r),obstacles.addChild(o),obstacles.addChild(i),obstacles.addChild(c),obstacles.addChild(n),stage.addChild(obstacles),obstacles.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;obstacles.x-=t/1e3*50,obstacles.x<=-500&&(obstacles.x=500)}})}function createStart(){start=new createjs.Container;var e=new createjs.Text("Click to Start","48px Arial","#F00"),a=new createjs.Shape;a.graphics.beginFill("white").drawRect(0,0,290,50),start.addChild(a),start.addChild(e),start.name="start",start.x=200,start.y=150,start.clicked=!1}function cleanObjects(){stage.removeChild(stage.getChildByName("player")),stage.removeChild(stage.getChildByName("circleContainer"))}function createStage(){score=0,stage.removeAllChildren(),generateFarBackgroundObstacles(),generateBackgroundObstacles(),createPlayer(),generateObstacles(),createBullets(),createObstacleBullets(),createCircle(),createHealth(),createAmmo(),createStart(),createScore()}function init(){stage=new createjs.Stage("demoCanvas"),createStage(),addStart(),createjs.Ticker.on("tick",tick)}function handleHitObjects(){for(var e=stage.getObjectsUnderPoint(stage.mouseX,stage.mouseY,0),a=!1,t=0;t<e.length;t++){var l=e[t];l.parent===circleContainer&&(a=!0)}circleContainer.alpha=a?.5:1;for(var r=stage.getObjectsUnderPoint(player.x,player.y,0),o=!1,i=0;i<r.length;i++)l=r[i],l.parent===obstacles?o=!0:l.parent===oBullets&&(o=!0);obstacles.alpha=o?.5:1,lose=o?!0:!1;for(var c=0;c<bullets.children.length;c++){var n=bullets.children[c];if(n.active){var s=stage.getObjectsUnderPoint(n.x,n.y,0),d=!1;s.length>0&&console.log("bhits: "+s.length);for(var h=0;h<s.length;h++)l=s[h],l.parent===obstacles&&(d=!0,console.log("stage hit by bullet"),l.alpha=0,n.active=!1,n.x=player.x,n.y=player.y,n.alpha=0,activeBulletCount--,score+=25)}}}function tick(e){createjs.Ticker.paused||(testLose(),handleHitObjects(),updateScore()),stage.update(e),resetControls()}function updateScore(){var e=stage.getChildByName("scoreLabel");console.log("scoreLabel: "+e),stage.removeChild(e),createScore()}function playerFire(){MAX_BULLETS>activeBulletCount&&(activeBulletCount++,bullets.children[activeBulletCount].active=!0,bullets.children[activeBulletCount].x=player.x,bullets.children[activeBulletCount].y=player.y)}function testLose(){var e,a,t;e=new createjs.Text("Lose","48px Arial","#F00"),e.x=50,e.y=10,e.alpha=.5,e.name="loseLabel",a=new createjs.Text("Killed","48px Arial","#F00"),a.x=300,a.y=10,a.alpha=.5,a.name="killedLabel",lose?(stage.addChild(e),player.explode(),player.health-=5):(player.notExplode(),stage.removeChild(stage.getChildByName("loseLabel"))),player.health<=0&&(t=new createjs.Text("You lasted: "+timer+" seconds","24px Arial","white"),t.x=50,t.y=50,t.alpha=.9,t.name="timerLabel",stage.addChild(t),clearInterval(timerInterval),stage.removeChild(stage.getChildByName("loseLabel")),addStart())}function addStart(){stage.addChild(start),createjs.Ticker.paused=!0,start.on("click",function(e){start.clicked=!0,createjs.Ticker.paused=!1,player.health=FULL_HEALTH,createStage(),startTimer()})}function startTimer(){var e=new Date;timerInterval=setInterval(function(){timer=Math.round((new Date-e)/1e3,0)},1e3)}function printMouse(){console.log("stage.mouseX: "+stage.mouseX),console.log("stage.mouseY: "+stage.mouseY),console.log("player.y: "+player.y)}var stage,circleContainer,player,up,down,left,right,floor,maxFloor,obstacles,lose,start,FULL_HEALTH,timer,timerInterval,bullets,activeBullets,fire,MAX_BULLETS,activeBulletCount,INDICATOR_HEIGHT,oBullets,activeOBulletCount,wall,score;wall=500,floor=maxFloor=250,lose=!1,FULL_HEALTH=25,timer=0,activeBullets=[],activeBulletCount=activeOBulletCount=0,MAX_BULLETS=10,INDICATOR_HEIGHT=100,score=0,resetControls(),window.onkeydown=function(e){switch(e.which){case 38:up=!0,down=!1,left=!1,right=!1,fire=!1;break;case 39:up=!1,down=!1,left=!1,right=!0,fire=!1;break;case 40:up=!1,down=!0,left=!1,right=!1,fire=!1;break;case 37:up=!1,down=!1,left=!0,right=!1,fire=!1;break;case 32:up=!1,down=!1,left=!1,right=!1,fire=!0,playerFire()}e.preventDefault()};var colors={map:{0:"red",1:"blue",2:"yellow",3:"cyan",4:"green",5:"white",6:"gray"},count:7};