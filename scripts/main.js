"use strict";function createScore(){var e;e=new createjs.Text("Score: "+score,"24px Arial","white"),e.x=50,e.y=10,e.alpha=.9,e.name="scoreLabel",stage.addChild(e)}function createInterfaceContainer(){var e=new createjs.Shape;e.name="ui",e.graphics.beginFill("white").drawRect(15,floor+10,50,-INDICATOR_HEIGHT-20),e.alpha=.5,stage.addChild(e)}function createHealth(){var e=new createjs.Shape;e.name="health",e.on("tick",function(a){if(!a.paused){var t=player.health*INDICATOR_HEIGHT/FULL_HEALTH;e.graphics.clear(),e.graphics.beginFill("red").drawRect(25,floor,5,-t)}}),stage.addChild(e)}function createAmmo(){var e=new createjs.Shape;e.name="ammo",e.on("tick",function(a){if(!a.paused){var t=(MAX_BULLETS-activeBulletCount)*INDICATOR_HEIGHT/MAX_BULLETS;e.graphics.clear(),e.graphics.beginFill("black").drawRect(50,floor,5,-t)}}),stage.addChild(e)}function createObstacleBullets(){oBullets=new createjs.Container,oBullets.name="oBullets";for(var e=50,a=0;e>a;a++){var t=new createjs.Shape;t.name="ob:"+a,t.graphics.setStrokeStyle(2),t.graphics.beginStroke("red"),t.graphics.drawCircle(0,0,5),t.active=!1,oBullets.addChild(t)}stage.addChild(oBullets),bullets.on("tick",function(e){if(!e.paused){var a=obstacles.children.length,t=obstacles.children[getRandomInt(0,a)],l=getRandomInt(0,oBullets.children.length),r=oBullets.children[l];t.alpha>0&&!r.active&&obstacles.x+t.leftx<wall&&(r.active=!0,r.x=obstacles.x+t.leftx,r.y=obstacles.y+t.middle-t.bottomy);for(var o=0;o<oBullets.children.length;o++){var c=oBullets.children[o];c.active&&(c.alpha=1,c.x-=5),c.x<=-50&&(c.active=!1,c.alpha=1)}}})}function getRandomInt(e,a){return Math.floor(Math.random()*(a-e))+e}function createBullets(){bullets=new createjs.Container;for(var e=0;MAX_BULLETS>e;e++){var a=new createjs.Shape;a.name="bullet:"+e,a.graphics.setStrokeStyle(2),a.graphics.beginStroke("white"),a.graphics.drawCircle(0,0,5),a.active=!1,a.alpha=0,bullets.addChild(a)}stage.addChild(bullets),bullets.on("tick",function(e){if(!e.paused)for(var a=0;a<bullets.children.length;a++){var t=bullets.children[a];t.active&&(t.alpha=1,t.x+=5),t.x>=500&&(t.active=!1,t.x=player.x,t.y=player.y,t.alpha=0,activeBulletCount--)}})}function createPlayer(){var e=.8,a=4,t=0,l=0;player=new createjs.Container,player.name="player",player.health=FULL_HEALTH;var r=new createjs.Shape;r.graphics.beginFill("white").drawRect(-2.5,-2.5,5,5);var o=new createjs.Shape;o.graphics.beginFill("purple").drawRect(-5,-5,10,10);var c=new createjs.Shape;c.graphics.beginFill("white").drawRect(-10,-10,20,20),player.x=200,player.y=floor-50,player.addChild(c),player.addChild(o),player.addChild(r),stage.addChild(player),player.on("tick",function(r){if(!r.paused){keys[38]&&l>-a&&l--,keys[40]&&a>l&&l++,keys[39]&&a>t&&t++,keys[37]&&t>-a&&t--,l*=e,player.y+=l,t*=e,player.x+=t}}),player.explode=function(){var e,a;e=player.getChildByName("littleExplode"),a=player.getChildByName("bigExplode"),e||(e=new createjs.Shape,e.alpha=1),e.graphics.setStrokeStyle(2),e.graphics.beginStroke("yellow"),e.graphics.drawCircle(0,0,20),e.name="littleExplode",a||(a=new createjs.Shape,a.alpha=1),a.graphics.setStrokeStyle(2),a.graphics.beginStroke("red"),a.graphics.drawCircle(0,0,30),a.name="bigExplode",player.addChild(e),player.addChild(a)},player.notExplode=function(){var e=player.getChildByName("littleExplode"),a=player.getChildByName("bigExplode");player.removeChild(e),player.removeChild(a)},player.fire=function(){MAX_BULLETS>activeBulletCount&&(activeBulletCount++,bullets.children[activeBulletCount].active=!0,bullets.children[activeBulletCount].x=player.x,bullets.children[activeBulletCount].y=player.y)}}function createCircle(){circleContainer=new createjs.Container;var e=new createjs.Shape;e.graphics.setStrokeStyle(3),e.graphics.beginStroke("yellow"),e.graphics.moveTo(0,20),e.graphics.lineTo(0,40),e.graphics.endStroke(),e.name="line";var a=new createjs.Shape;a.graphics.beginFill("red").drawCircle(0,0,10);var t=new createjs.Shape;t.graphics.beginFill("grey").drawCircle(0,0,40),circleContainer.x=50,circleContainer.y=floor,circleContainer.addChild(t),circleContainer.addChild(a),circleContainer.addChild(e),stage.addChild(circleContainer),circleContainer.on("tick",function(a){var t=a,l=t.delta;e.rotation+=l/1e3*100})}function generateObstacles(){var e,a,t,l,r,o;o=100,l=50,obstacles=new createjs.Container,obstacles.name="obstacles",obstacles.x=400,obstacles.y=floor,stage.addChild(obstacles);for(var c=0;o>c;c++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=c*(l+10),t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+l,l,-l),e.name="o"+c,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,obstacles.addChild(e),e.explode=function(){console.log("explode"),this.alpha=.75},e.notExplode=function(){console.log("not explode"),this.alpha=0};obstacles.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;obstacles.x-=t/1e3*50;getRandomInt(0,o);obstacles.x<=-(o*(l+10))&&(obstacles.x=wall)}})}function generateBackgroundObstacles(){var e,a,t,l,r,o;o=50,l=10;var c=new createjs.Container;c.name="obstacles",c.x=400,c.y=floor,stage.addChild(c);for(var n=0;o>n;n++)r="white",e=new createjs.Shape,a=30*n,t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+l,l,-l),e.name="o"+n,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.alpha=.5,c.addChild(e);c.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;c.x-=t/1e3*25,c.x<=-500&&(c.x=500)}})}function generateFarBackgroundObstacles(){var e,a,t,l,r,o;o=50,l=200;var c=new createjs.Container;c.name="obstacles",c.x=400,c.y=floor,stage.addChild(c);for(var n=0;o>n;n++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=30*n,t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+l,l,-l),e.name="o"+n,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.alpha=.25,c.addChild(e);c.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;c.x-=t/1e3*5,c.x<=-500&&(c.x=500)}})}function createObstacles(){obstacles=new createjs.Container,obstacles.name="obstacles";var e=new createjs.Shape;e.graphics.beginFill("blue").drawRect(0,0,50,-100),e.name="o1",e.leftx=0,e.middle=50,e.bottomy=0;var a=new createjs.Shape;a.graphics.beginFill("yellow").drawRect(100,-100,50,-50),a.name="o2",a.middle=25,a.leftx=100,a.bottomy=100;var t=new createjs.Shape;t.graphics.beginFill("green").drawRect(200,0,50,-100),t.name="o3",t.middle=50,t.leftx=200,t.bottomy=0;var l=new createjs.Shape;l.graphics.beginFill("blue").drawRect(300,-150,50,-50),l.name="o4",l.middle=25,l.leftx=300,l.bottomy=150;var r=new createjs.Shape;r.graphics.beginFill("green").drawRect(400,-150,50,-50),r.name="o5",r.middle=25,r.leftx=400,r.bottomy=150;var o=new createjs.Shape;o.graphics.beginFill("cyan").drawRect(500,-150,50,-100),o.name="o6",o.middle=50,o.leftx=500,o.bottomy=150;var c=new createjs.Shape;c.graphics.beginFill("blue").drawRect(600,-100,50,-150),c.name="o7",c.middle=75,c.leftx=600,c.bottomy=100;var n=new createjs.Shape;n.graphics.beginFill("green").drawRect(700,-100,-50,-50),n.name="o8",n.middle=25,n.leftx=700,n.bottomy=100;var i=new createjs.Shape;i.graphics.beginFill("blue").drawRect(800,-100,50,-150),i.name="o9",i.middle=75,i.leftx=800,i.bottomy=100,obstacles.x=400,obstacles.y=floor,obstacles.addChild(e),obstacles.addChild(a),obstacles.addChild(t),obstacles.addChild(l),obstacles.addChild(r),obstacles.addChild(o),obstacles.addChild(c),obstacles.addChild(n),obstacles.addChild(i),stage.addChild(obstacles),obstacles.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;obstacles.x-=t/1e3*50,obstacles.x<=-500&&(obstacles.x=500)}})}function createStart(){start=new createjs.Container;var e=new createjs.Text("Click to Start","48px Arial","#F00"),a=new createjs.Shape;a.graphics.beginFill("white").drawRect(0,0,290,50),start.addChild(a),start.addChild(e),start.name="start",start.x=200,start.y=150,start.clicked=!1}function createStage(){score=0,stage.removeAllChildren(),generateFarBackgroundObstacles(),generateBackgroundObstacles(),createPlayer(),generateObstacles(),createBullets(),createObstacleBullets(),createInterfaceContainer(),createHealth(),createAmmo(),createStart(),createScore()}function init(){stage=new createjs.Stage("demoCanvas"),createStage(),addStart(),createjs.Ticker.on("tick",tick)}function handleHitObjects(){for(var e,a=stage.getObjectsUnderPoint(player.x,player.y,0),t=!1,l=0;l<a.length;l++)e=a[l],e.parent===obstacles?t=!0:e.parent===oBullets&&(t=!0);obstacles.alpha=t?.5:1,lose=t?!0:!1;for(var r=0;r<bullets.children.length;r++){var o=bullets.children[r];if(o.active)for(var c=stage.getObjectsUnderPoint(o.x,o.y,0),n=!1,i=0;i<c.length;i++)e=c[i],e.parent===obstacles&&(n=!0,console.log("stage hit by bullet"),e.explode(),e.notExplode(),e.alpha=0,o.active=!1,o.x=player.x,o.y=player.y,o.alpha=0,activeBulletCount--,score+=25)}}function tick(e){createjs.Ticker.paused||(testLose(),handleHitObjects(),updateScore()),stage.update(e)}function updateScore(){var e=stage.getChildByName("scoreLabel");stage.removeChild(e),createScore()}function testLose(){var e,a,t;e=new createjs.Text("Lose","48px Arial","#F00"),e.x=50,e.y=10,e.alpha=.5,e.name="loseLabel",a=new createjs.Text("Killed","48px Arial","#F00"),a.x=300,a.y=10,a.alpha=.5,a.name="killedLabel",lose?(stage.addChild(e),player.explode(),player.health-=5):(player.notExplode(),stage.removeChild(stage.getChildByName("loseLabel"))),player.health<=0&&(t=new createjs.Text("You lasted: "+timer+" seconds","24px Arial","white"),t.x=50,t.y=50,t.alpha=.9,t.name="timerLabel",stage.addChild(t),clearInterval(timerInterval),stage.removeChild(stage.getChildByName("loseLabel")),addStart())}function addStart(){stage.addChild(start),createjs.Ticker.paused=!0,start.on("click",function(){start.clicked=!0,createjs.Ticker.paused=!1,player.health=FULL_HEALTH,createStage(),startTimer()})}function startTimer(){var e=new Date;timerInterval=setInterval(function(){timer=Math.round((new Date-e)/1e3,0)},1e3)}function printMouse(){console.log("stage.mouseX: "+stage.mouseX),console.log("stage.mouseY: "+stage.mouseY),console.log("player.y: "+player.y)}var stage,circleContainer,player,floor,obstacles,lose,start,FULL_HEALTH,timer,timerInterval,bullets,activeBullets,MAX_BULLETS,activeBulletCount,INDICATOR_HEIGHT,oBullets,activeOBulletCount,wall,score,keys;keys=[],wall=500,floor=250,lose=!1,FULL_HEALTH=25,timer=0,activeBullets=[],activeBulletCount=activeOBulletCount=0,MAX_BULLETS=10,INDICATOR_HEIGHT=100,score=0,document.body.addEventListener("keydown",function(e){keys[e.which]=!0,32===e.which&&player.fire(),e.preventDefault()}),document.body.addEventListener("keyup",function(e){keys[e.keyCode]=!1,e.preventDefault()});var colors={map:{0:"red",1:"blue",2:"yellow",3:"cyan",4:"green",5:"white",6:"gray"},count:7};