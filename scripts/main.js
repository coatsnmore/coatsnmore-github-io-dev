"use strict";function createScore(){var e;e=new createjs.Text("Score: "+score,"24px Arial","white"),e.x=5,e.y=10,e.alpha=.9,e.name="scoreLabel",stage.addChild(e);var a;a=new createjs.Text("Rings: "+goalsHit+"/"+GOALS,"24px Arial","gold"),a.x=5,a.y=40,a.alpha=.9,a.name="goalLabel",stage.addChild(a)}function createInterfaceContainer(){var e=new createjs.Shape;e.name="ui",e.graphics.beginFill("white").drawRect(15,floor+10,50,-INDICATOR_HEIGHT-20),e.alpha=.5,stage.addChild(e)}function createHealth(){var e=new createjs.Shape;e.name="health",e.on("tick",function(a){if(!a.paused){var t=player.health*INDICATOR_HEIGHT/FULL_HEALTH;e.graphics.clear(),e.graphics.beginFill("red").drawRect(25,floor,15,-t)}}),stage.addChild(e)}function createAmmo(){var e=new createjs.Shape;e.name="ammo",e.on("tick",function(a){if(!a.paused){var t=(MAX_BULLETS-activeBulletCount)*INDICATOR_HEIGHT/MAX_BULLETS;e.graphics.clear(),e.graphics.beginFill("black").drawRect(40,floor,15,-t)}}),stage.addChild(e)}function createObstacleBullets(){oBullets=new createjs.Container,oBullets.name="oBullets";for(var e=200,a=0;e>a;a++){var t=createLaserBlast();t.name="ob:"+a,t.active=!1,oBullets.addChild(t)}stage.addChild(oBullets),bullets.on("tick",function(e){if(!e.paused){var a=obstacles.children.length,t=obstacles.children[getRandomInt(0,a)],l=getRandomInt(0,oBullets.children.length),r=oBullets.children[l];t.alpha>0&&!r.active&&obstacles.x+t.leftx<wall&&(r.active=!0,r.x=obstacles.x+t.x+t.leftx,r.y=obstacles.y+t.y+t.middle-t.bottomy);for(var n=0;n<oBullets.children.length;n++){var o=oBullets.children[n];if(o.active){var s=e.delta;o.x-=s/1e3*150,o.alpha=1}o.x<=-50&&(o.active=!1,o.alpha=1)}}})}function getRandomInt(e,a){return Math.floor(Math.random()*(a-e))+e}function createBullets(){bullets=new createjs.Container;for(var e=0;MAX_BULLETS>e;e++){var a=createLaserBlast();a.name="bullet:"+e,a.active=!1,a.alpha=0,bullets.addChild(a)}stage.addChild(bullets),bullets.on("tick",function(e){if(!e.paused)for(var a=0;a<bullets.children.length;a++){var t=bullets.children[a];t.active&&(t.alpha=1,t.x+=5),t.x>=wall&&(t.active=!1,t.x=player.x,t.y=player.y,t.alpha=0,activeBulletCount--)}})}function createPlayer(){var e=.8,a=50,t=0,l=0,r=createShip();player=new createjs.Container,player.sizeX=r.sizeX,player.sizeY=r.sizeY,player.name="player",player.health=FULL_HEALTH;var n=new createjs.Shape;n.graphics.beginFill("white").drawRect(-2.5,-2.5,5,5);var o=new createjs.Shape;o.graphics.beginFill("purple").drawRect(-5,-5,10,10);var s=new createjs.Shape;s.graphics.beginFill("white").drawRect(-10,-10,20,20),player.x=200,player.y=floor-50,player.addChild(r),stage.addChild(player),player.on("tick",function(r){if(!r.paused){keys[38]&&l>-a&&l--,keys[40]&&a>l&&l++,keys[39]&&a>t&&t++,keys[37]&&t>2*-a&&t--,l*=e,player.y+=l,t*=e,player.x+=t}}),player.explode=function(){var e,a;e=player.getChildByName("littleExplode"),a=player.getChildByName("bigExplode"),e||(e=new createjs.Shape,e.alpha=1,e.x=player.sizeX/2,e.y=player.sizeY/2),e.graphics.setStrokeStyle(2),e.graphics.beginStroke("yellow"),e.graphics.drawCircle(0,0,20),e.name="littleExplode",a||(a=new createjs.Shape,a.alpha=1,a.x=player.sizeX/2,a.y=player.sizeY/2),a.graphics.setStrokeStyle(2),a.graphics.beginStroke("red"),a.graphics.drawCircle(0,0,30),a.name="bigExplode",player.addChild(e),player.addChild(a)},player.notExplode=function(){var e=player.getChildByName("littleExplode"),a=player.getChildByName("bigExplode");player.removeChild(e),player.removeChild(a)},player.fire=function(){MAX_BULLETS>activeBulletCount&&(activeBulletCount++,bullets.children[activeBulletCount].active=!0,bullets.children[activeBulletCount].x=player.x+player.sizeX,bullets.children[activeBulletCount].y=player.y)}}function createCircle(){circleContainer=new createjs.Container;var e=new createjs.Shape;e.graphics.setStrokeStyle(3),e.graphics.beginStroke("yellow"),e.graphics.moveTo(0,20),e.graphics.lineTo(0,40),e.graphics.endStroke(),e.name="line";var a=new createjs.Shape;a.graphics.beginFill("red").drawCircle(0,0,10);var t=new createjs.Shape;t.graphics.beginFill("grey").drawCircle(0,0,40),circleContainer.x=50,circleContainer.y=floor,circleContainer.addChild(t),circleContainer.addChild(a),circleContainer.addChild(e),stage.addChild(circleContainer),circleContainer.on("tick",function(a){var t=a,l=t.delta;e.rotation+=l/1e3*100})}function generateGoals(){var e,a,t,l;a=400,t=128,l=500,e=LEVEL_LENGTH||800,goals=new createjs.Container,goals.x=l,goals.y=floor,stage.addChild(goals);for(var r=0;GOALS>r;r++){var n=createRing();n.name="goal:"+r,n.x=r*(t+a),n.y=getRandomInt(0,-floor-10),goals.addChild(n)}goals.on("tick",function(a){a.paused||(goals.x-=a.delta/1e3*50,goals.x<=-e&&(goals.x=0))})}function generateObstacles(){var e,a,t,l,r,n,o,s,i,c,d,p,h;d=500,l=20,h=20,n=(wall-d)/(l+h)+d/(l+h),i=3,c=.9,o=0,s=0,p=3,n*=2,obstacles=new createjs.Container,obstacles.name="obstacles",obstacles.x=d,obstacles.y=floor,stage.addChild(obstacles);for(var g,u=0;n>u;u++)r=colors.map[getRandomInt(0,colors.count)],a=u*(l+h+10),t=getRandomInt(0,floor),e=new createjs.Shape,e.graphics.beginFill(r).drawRect(a,-t+l,l,-l),e.x=a,e.y=-t,e.name="o"+u,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.vX=0,e.vY=0,obstacles.addChild(e),e.explode=function(){this.alpha=.75},e.notExplode=function(){this.alpha=0},g=a,LEVEL_LENGTH=a;for(u=0;n>u;u++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=u*(l+h),t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+2*l,2*l,3*-l),e.name="2o"+u,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.vX=0,e.vY=0,obstacles.addChild(e),e.explode=function(){this.alpha=.75},e.notExplode=function(){this.alpha=0};for(u=0;n>u;u++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=u*(l+h),t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+3*l,3*l,2*-l),e.name="2o"+u,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.vX=0,e.vY=0,obstacles.addChild(e),e.explode=function(){console.log("explode"),this.alpha=.75},e.notExplode=function(){console.log("not explode"),this.alpha=0};obstacles.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;i>o&&o++,i>s&&s++,o*=c,obstacles.x-=o;var l=getRandomInt(0,n*p),r=obstacles.children[l];r.x+=o*(50*t/1e3),r.y-=s*(50*t/1e3),l=getRandomInt(0,n*p),r=obstacles.children[l],r.x-=o*(25*t/1e3),r.y+=s*(25*t/1e3),l=getRandomInt(0,n*p),r=obstacles.children[l],r.x-=o*(25*t/1e3),r.y+=s*(25*t/1e3),obstacles.x<=-g&&(obstacles.x=wall)}})}function generateBackgroundObstacles(){var e,a,t,l,r,n;n=50,l=10;var o=new createjs.Container;o.name="obstacles",o.x=10,o.y=floor,stage.addChild(o);for(var s,i=0;n>i;i++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=30*i,t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+l,l,-l),e.name="o"+i,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.alpha=.5,o.addChild(e),s=a;o.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;o.x-=t/1e3*25,o.x<=-s&&(o.x=0)}})}function generateFarBackgroundObstacles(){var e,a,t,l,r,n;n=50,l=200;var o=new createjs.Container;o.name="obstacles",o.x=400,o.y=floor,stage.addChild(o);for(var s=0;n>s;s++)r=colors.map[getRandomInt(0,colors.count)],e=new createjs.Shape,a=30*s,t=getRandomInt(0,floor),e.graphics.beginFill(r).drawRect(a,-t+l,l,-l),e.name="o"+s,e.leftx=a,e.middle=l/2,e.bottomy=t,e.color=r,e.alpha=.25,o.addChild(e);o.on("tick",function(e){if(!e.paused){var a=e,t=a.delta;o.x-=t/1e3*5,o.x<=-500&&(o.x=500)}})}function createStart(){start=new createjs.Container;var e=new createjs.Text("Click to Start","48px Arial","black"),a=new createjs.Text("Collect the rings!","24px Arial","red");a.y=50;var t=new createjs.Shape;t.graphics.beginFill("white").drawRect(0,0,300,100),start.addChild(t),start.addChild(e),start.addChild(a),start.name="start",start.x=200,start.y=floor/2,start.clicked=!1}function createRing(){var e={images:["images/ring.png"],frames:{width:256,height:256},animations:{stand:0}},a=new createjs.SpriteSheet(e),t=new createjs.Sprite(a,"stand");return t.scaleY=t.scaleX=.2,t}function createLaserBlast(){var e=64,a=64,t=.3,l={images:["images/laser_blast.png"],frames:{width:e,height:a},animations:{stand:0}},r=new createjs.SpriteSheet(l),n=new createjs.Sprite(r,"stand");return n.sizeX=e*t,n.sizeY=a*t,n.scaleY=n.scaleX=t,n}function createYeoman(){var e={images:["images/yeoman.png"],frames:{width:180,height:180},animations:{stand:0}},a=new createjs.SpriteSheet(e),t=new createjs.Sprite(a,"stand");return t.scaleY=t.scaleX=.2,t}function createShip(){var e=64,a=29,t=.75,l={images:["images/Spritesheet_64x29.png"],frames:{width:e,height:a},animations:{first:[0,3,"first",.5]}},r=new createjs.SpriteSheet(l),n=new createjs.Sprite(r,"first");return n.scaleY=n.scaleX=t,n.sizeX=e*t,n.sizeY=a*t,n}function createStage(){score=0,stage.removeAllChildren(),generateFarBackgroundObstacles(),generateBackgroundObstacles(),createPlayer(),generateObstacles(),createYeoman(),createBullets(),createObstacleBullets(),generateGoals(),createInterfaceContainer(),createHealth(),createAmmo(),createStart(),createScore()}function init(){stage=new createjs.Stage("canvas"),createStage(),addStart(),createjs.Ticker.on("tick",tick)}function handleHitObjects(){for(var e,a=stage.getObjectsUnderPoint(player.x,player.y,0),t=!1,l=0;l<a.length;l++)e=a[l],e.parent===obstacles?t=!0:e.parent===oBullets?t=!0:e.parent===goals&&(e.alpha=0,goalsHit++);a=stage.getObjectsUnderPoint(player.x+player.sizeX,player.y,0);for(var r=0;r<a.length;r++)e=a[r],e.parent===obstacles?t=!0:e.parent===oBullets?t=!0:e.parent===goals&&(e.alpha=0,goalsHit++);for(a=stage.getObjectsUnderPoint(player.x+player.sizeX,player.y+player.sizeY,0),r=0;r<a.length;r++)e=a[r],e.parent===obstacles?t=!0:e.parent===oBullets?t=!0:e.parent===goals&&(e.alpha=0,goalsHit++);for(a=stage.getObjectsUnderPoint(player.x,player.y+player.sizeY,0),r=0;r<a.length;r++)e=a[r],e.parent===obstacles?t=!0:e.parent===oBullets?t=!0:e.parent===goals&&(e.alpha=0,goalsHit++);obstacles.alpha=t?.5:1,lose=t?!0:!1;for(var n=0;n<bullets.children.length;n++){var o=bullets.children[n];if(o.active)for(var s=stage.getObjectsUnderPoint(o.x,o.y,0),i=!1,c=0;c<s.length;c++)e=s[c],e.parent===obstacles&&(i=!0,e.explode(),e.notExplode(),e.alpha=0,o.active=!1,o.x=player.x,o.y=player.y,o.alpha=0,activeBulletCount--,score+=50)}}function tick(e){createjs.Ticker.paused||(testLose(),testWin(),handleHitObjects(),updateScore()),stage.update(e)}function testWin(){if(goalsHit>=GOALS){var e;e=new createjs.Text("You got all the rings! You win!","48px Arial","white"),e.x=50,e.y=80,e.alpha=.9,e.name="winLabel",stage.addChild(e),addStart()}}function updateScore(){var e=stage.getChildByName("scoreLabel");stage.removeChild(e);var a=stage.getChildByName("goalLabel");stage.removeChild(a),createScore()}function playerOutOfBounds(){var e=!1;return(player.x<=0||player.x>=wall||player.y<=0||player.y>=floor+10)&&(e=!0),e}function testLose(){var e,a,t;e=new createjs.Text("Lose","48px Arial","#F00"),e.x=200,e.y=10,e.alpha=.5,e.name="loseLabel",a=new createjs.Text("Killed","48px Arial","#F00"),a.x=300,a.y=10,a.alpha=.5,a.name="killedLabel",lose||playerOutOfBounds()?(player.explode(),player.health--):player.notExplode(),player.health<=0&&(t=new createjs.Text("You lasted: "+timer+" seconds","24px Arial","white"),t.x=200,t.y=80,t.alpha=.9,t.name="timerLabel",stage.addChild(t),stage.removeChild(stage.getChildByName("loseLabel")),addStart())}function addStart(){stage.addChild(start),createjs.Ticker.paused=!0,clearInterval(timerInterval),start.on("click",function(){start.clicked=!0,createjs.Ticker.paused=!1,player.health=FULL_HEALTH,activeBulletCount=0,goalsHit=0,createStage(),startTimer()})}function startTimer(){var e=new Date;timerInterval=setInterval(function(){timer=Math.round((new Date-e)/1e3,0)},1e3)}function printMouse(){console.log("stage.mouseX: "+stage.mouseX),console.log("stage.mouseY: "+stage.mouseY),console.log("player.y: "+player.y)}var stage,circleContainer,player,floor,obstacles,lose,start,FULL_HEALTH,timer,timerInterval,bullets,activeBullets,MAX_BULLETS,activeBulletCount,INDICATOR_HEIGHT,oBullets,activeOBulletCount,wall,score,keys,canvas,LEVEL_LENGTH,goals,goalsHit,GOALS;canvas=document.getElementById("canvas"),canvas.width=800,canvas.height=600,keys=[],wall=canvas.width,floor=canvas.height-50,lose=!1,FULL_HEALTH=25,timer=0,activeBullets=[],activeBulletCount=activeOBulletCount=0,MAX_BULLETS=10,INDICATOR_HEIGHT=100,score=0,goalsHit=0,GOALS=5,document.body.addEventListener("keydown",function(e){keys[e.which]=!0,32===e.which&&player.fire(),e.preventDefault()}),document.body.addEventListener("keyup",function(e){keys[e.keyCode]=!1,e.preventDefault()});var colors={map:{0:"red",1:"blue",2:"yellow",3:"cyan",4:"green",5:"white",6:"purple",7:"orange"},count:8};